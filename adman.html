<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- ุชุฑููุฒ ุงูุฃุญุฑู -->
    <meta charset="UTF-8">

    <!-- ุชูุงูู ุงูุนุฑุถ ุนูู ุงูุฌูุงู -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ุนููุงู ุงูุตูุญุฉ -->
    <title>Jomaro Restaurant and Cafe - ุงุณุชูุชุน ุจุฃูุถู ุงููุฃูููุงุช ูุงููุดุฑูุจุงุช</title>

    <!-- ูุตู ุงูุตูุญุฉ -->
    <meta name="description" content="ูุทุนู ููุงููู ุฌููุงุฑู - ููุงูู ุงููุซุงูู ููุงุณุชูุชุงุน ุจุฃุทุจุงู ูุฐูุฐุฉ ููุดุฑูุจุงุช ูุงุฎุฑุฉ ูู ุฃุฌูุงุก ุฃูููุฉ. ุงุญุฌุฒ ุทุงููุชู ุงูุขู!">

    <!-- ููุชุง ุงูุฑูุจูุชุงุช -->
    <meta name="robots" content="index, follow">

    <!-- ุฑุงุจุท ูุงูููููุงู -->
    <link rel="canonical" href="https://example.com/this-page">

    <!-- ุฃููููุฉ ุงููููุน (Favicon) -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">
    <link rel="icon" type="image/png" sizes="16x16" href="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">

    <!-- Open Graph Tags (ููุดุงุฑูุฉ ุงูุตูุญุฉ ุนูู ููุณุจููุ ูุงุชุณุงุจุ ุฅูุฎ) -->
    <meta property="og:title" content="Jomaro Restaurant and Cafe">
    <meta property="og:description" content="ูุทุนู ููุงููู ุฌููุงุฑู - ููุงูู ุงููุซุงูู ููุงุณุชูุชุงุน ุจุฃุทุจุงู ูุฐูุฐุฉ ููุดุฑูุจุงุช ูุงุฎุฑุฉ ูู ุฃุฌูุงุก ุฃูููุฉ.">
    <meta property="og:image" content="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">
    <meta property="og:url" content="https://example.com/this-page">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_AR">

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Jomaro Restaurant and Cafe">
    <meta name="twitter:description" content="ูุทุนู ููุงููู ุฌููุงุฑู - ููุงูู ุงููุซุงูู ููุงุณุชูุชุงุน ุจุฃุทุจุงู ูุฐูุฐุฉ ููุดุฑูุจุงุช ูุงุฎุฑุฉ ูู ุฃุฌูุงุก ุฃูููุฉ.">
    <meta name="twitter:image" content="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">
    <meta name="twitter:site" content="@your_twitter_handle"> <!-- ุงุณุชุจุฏู ุจุงุณู ุญุณุงุจู ุนูู ุชููุชุฑ -->

    <!-- ููู ุงูุซูู ูููุชุตูุญุงุช ุงูุญุฏูุซุฉ -->
    <meta name="theme-color" content="#d62828"> <!-- ููู ุฃุญูุฑ ููุงุณุจ ูููุทุงุนู -->

    <!-- ุงุณู ุงููุคูู ุฃู ุงูุดุฑูุฉ -->
    <meta name="author" content="Jomaro Restaurant and Cafe">

    <!-- ูููุงุช ููุชุงุญูุฉ (ุงุฎุชูุงุฑู - ูุง ุชุคุซุฑ ูู SEO ููู ุจุนุถ ุงูุฃูุธูุฉ ุชุณุชุฎุฏููุง) -->
    <meta name="keywords" content="ูุทุนู, ูุงููู, ุฌููุงุฑู, ุทุนุงู, ูุดุฑูุจุงุช, ุญุฌุฒ ุทุงููุฉ, ูุฃูููุงุช, ุดูุดุฉ, ูููุฉ, ุญูููุงุช">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ููุญุฉ ุชุญูู ุฌููุงุฑู</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="script/adman.css">
</head>
<body>
  <!-- ุตูุญุฉ ุงูุฏุฎูู -->
  <div id="loginPage" class="login-container">
    <div class="login-box">
      <h2><i class="fas fa-lock"></i> ุฏุฎูู ุงูุฅุฏุงุฑุฉ</h2>
      <div class="form-group">
        <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
        <input type="email" id="email" placeholder="admin@jomaro.com" />
      </div>
      <div class="form-group">
        <label>ูููุฉ ุงููุฑูุฑ</label>
        <input type="password" id="password" placeholder="********" />
      </div>
      <button class="btn" onclick="login()">ุชุณุฌูู ุงูุฏุฎูู</button>
      <div id="loginError" class="error"></div>
    </div>
  </div>
  <!-- ููุญุฉ ุงูุชุญูู -->
  <div id="dashboard" class="dashboard">
    <div class="header">
      <h1>ููุญุฉ ุชุญูู ุฌููุงุฑู</h1>
      <!-- --- ุงูุฒุฑ ุงูุฌุฏูุฏ ุงููุถุงู --- -->
      <!-- --- ููุงูุฉ ุงูุฒุฑ ุงูุฌุฏูุฏ --- -->
      <button class="logout-btn" onclick="logout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
    </div>
    <!-- ูุนูููุงุช ุงูุชุตุญูุญ -->
    <div class="debug-info" id="debugInfo">
      ุญุงูุฉ ุงูุงุชุตุงู: ุฌุงุฑู ุงูุชุญูู...
    </div>
    <!-- ุงูุชุจููุจุงุช -->
    <div class="tabs">
      <button class="logout-btn" style="background: #000000; border-color: #D4AF37;" onclick="window.open('admin-dashboard.html', '_blank')"> ุงูุฏุฑุฏุดุฉ</button>
      <button class="tab-btn" data-tab="categories">โ ุงูุฃูุณุงู</button>
      <button class="tab-btn active" data-tab="add-item">โ ุฅุถุงูุฉ ุตูู</button>
      <button class="tab-btn" data-tab="manage-items">๐ ุฅุฏุงุฑุฉ ุงูุฃุตูุงู</button>
      <button class="tab-btn" data-tab="orders">๐ฆ ุงูุทูุจุงุช</button>
      <button class="tab-btn" data-tab="promotions">๐ฏ ุงูุนุฑูุถ</button>
      <button class="tab-btn" data-tab="fix-data">๐ง ุฅุตูุงุญ ุงูุจูุงูุงุช</button>
    </div>
    <!-- 1. ุฅุฏุงุฑุฉ ุงูุฃูุณุงู -->
    <div id="categories" class="tab-content">
      <h2>ุฅุฏุงุฑุฉ ุงูุฃูุณุงู (ุฑุฆูุณูุฉ ููุฑุนูุฉ)</h2>
      <div class="form-row">
        <div class="form-group">
          <label>ุงุณู ุงููุณู ุงูุฑุฆูุณู ุงูุฌุฏูุฏ</label>
          <input type="text" id="mainCatName" placeholder="ูุซู: ูุฃูููุงุชุ ูุดุฑูุจุงุช" />
        </div>
        <div class="form-group">
          <button class="btn" onclick="addMainCategory()">ุฅุถุงูุฉ ูุณู ุฑุฆูุณู</button>
        </div>
      </div>
      <hr style="border: 1px solid #444; margin: 20px 0;" />
      <h3>ุฅุถุงูุฉ ูุณู ูุฑุนู</h3>
      <div class="form-row">
        <div class="form-group">
          <label>ุงุฎุชุฑ ุงููุณู ุงูุฑุฆูุณู</label>
          <select id="mainCatSelect"></select>
        </div>
        <div class="form-group">
          <label>ุงุณู ุงููุณู ุงููุฑุนู</label>
          <input type="text" id="subCatName" placeholder="ูุซู: ุจูุชุฒุงุ ูููุฉ" />
        </div>
        <div class="form-group">
          <button class="btn" onclick="addSubCategory()">ุฅุถุงูุฉ ุงููุณู ุงููุฑุนู</button>
        </div>
      </div>
    </div>
    <!-- 2. ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ -->
    <div id="add-item" class="tab-content active">
      <h2>ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ</h2>
      <div class="form-row">
        <div class="form-group">
          <label>ุงููุณู ุงูุฑุฆูุณู</label>
          <select id="addItemMainCat" onchange="loadSubCategoriesForItem()"></select>
        </div>
        <div class="form-group">
          <label>ุงููุณู ุงููุฑุนู</label>
          <select id="addItemSubCat"></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุงุณู (ุนุฑุจู)</label>
          <input type="text" id="itemNameAr" />
        </div>
        <div class="form-group">
          <label>ุงูุงุณู (ุฅูุฌููุฒู)</label>
          <input type="text" id="itemNameEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงููุตู (ุนุฑุจู)</label>
          <textarea id="itemDescAr"></textarea>
        </div>
        <div class="form-group">
          <label>ุงููุตู (ุฅูุฌููุฒู)</label>
          <textarea id="itemDescEn"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุณุนุฑ</label>
          <input type="number" id="itemPrice" step="0.5" />
        </div>
        <div class="form-group">
          <label>ุงูุฎุตู (%)</label>
          <input type="number" id="itemDiscount" value="0" min="0" max="100" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุฑุงุจุท ุงูุตูุฑุฉ</label>
          <input type="text" id="itemImageURL" placeholder="https://example.com/image.jpg ุฃู ุฑุงุจุท ุฌูุฌู ุฏุฑูู" />
        </div>
      </div>
      <!-- --- ุฒุฑ ูุงุญุฏ ููุท ูุฅุถุงูุฉ ุงูุตูู --- -->
      <div class="form-row" style="margin-top: 30px; justify-content: center;">
        <div class="form-group" style="flex: 1; min-width: 300px;">
          <button class="btn" onclick="addItemOnly()" style="width: 100%;">
            <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุงูุตูู
          </button>
        </div>
      </div>
    </div>
    <!-- 3. ุฅุฏุงุฑุฉ ุงูุฃุตูุงู -->
    <div id="manage-items" class="tab-content">
      <h2>ุชุนุฏูู ุฃู ุญุฐู ุงูุฃุตูุงู</h2>
      <div class="filter-section">
        <h3 class="filter-title">ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ</h3>
        <div class="filter-buttons" id="mainCategoriesFilter">
          <button class="filter-btn active" data-category="">ุฌููุน ุงูุฃูุณุงู</button>
        </div>
        <h3 class="filter-title">ุงูุฃูุณุงู ุงููุฑุนูุฉ</h3>
        <div class="filter-buttons" id="subCategoriesFilter">
          <button class="filter-btn active" data-subcategory="">ุฌููุน ุงููุฆุงุช</button>
        </div>
        <!-- ุฅุถุงูุฉ ุงูุจุญุซ ูุงูุชููุฑ -->
        <h3 class="filter-title">ุงูุจุญุซ ูุงูุชููุฑ</h3>
        <div class="search-availability">
          <div class="form-group">
            <label>ุงูุจุญุซ ุนู ุตูู</label>
            <input type="text" id="searchInput" placeholder="ุงุจุญุซ ุจุงูุงุณู..." oninput="filterItems()">
          </div>
          <div class="form-group">
            <label>ุงูุชููุฑ</label>
            <select id="availabilityFilter" onchange="filterItems()">
              <option value="">ุงููู</option>
              <option value="true">ูุชููุฑ ููุท</option>
              <option value="false">ุบูุฑ ูุชููุฑ</option>
            </select>
          </div>
        </div>
      </div>
      <div id="itemsContainer">
        <div class="loading">ุฌุงุฑู ุชุญููู ุงูุฃุตูุงู...</div>
      </div>
    </div>
    <!-- 4. ุงูุทูุจุงุช ุงููุงุฑุฏุฉ -->
    <div id="orders" class="tab-content">
      <h2>ุงูุทูุจุงุช ุงููุงุฑุฏุฉ</h2>
      <div class="filter-section">
        <div class="filter-buttons" id="statusFilter">
          <button class="filter-btn active" data-status="">ุฌููุน ุงูุทูุจุงุช</button>
          <button class="filter-btn" data-status="ููุฏ ุงูุชุญุถูุฑ">ููุฏ ุงูุชุญุถูุฑ</button>
          <button class="filter-btn" data-status="ุฌุงูุฒ ููุชูุฏูู">ุฌุงูุฒ</button>
          <button class="filter-btn" data-status="ุชู ุงูุชุณููู">ุชู ุงูุชุณููู</button>
        </div>
      </div>
      <div id="ordersContainer">
        <table class="orders-table">
          <thead>
            <tr>
              <th>ุงูุทูุจ</th>
              <th>ุงูููุช</th>
              <th>ุงูุทุงููุฉ</th>
              <th>ุงูุฃุตูุงู</th>
              <th>ุงูุฅุฌูุงูู</th>
              <th>ุงูุญุงูุฉ</th>
              <th>ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody id="ordersTableBody">
            <tr><td colspan="7" style="text-align:center; padding: 20px;">ุฌุงุฑู ุชุญููู ุงูุทูุจุงุช...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- 5. ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ุงูุชุฑููุฌูุฉ -->
    <div id="promotions" class="tab-content">
      <h2>ุฅุถุงูุฉ ุนุฑุถ ุชุฑููุฌู ุฌุฏูุฏ</h2>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุนููุงู (ุนุฑุจู)</label>
          <input type="text" id="promoTitleAr" placeholder="ุนุฑุถ ุฎุงุต ุนูู ูุฐุง ุงูุตูู" />
        </div>
        <div class="form-group">
          <label>ุงูุนููุงู (ุฅูุฌููุฒู)</label>
          <input type="text" id="promoTitleEn" placeholder="Special Offer on this item" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงููุต (ุนุฑุจู)</label>
          <textarea id="promoTextAr" placeholder="ุชูุงุตูู ุงูุนุฑุถ ุจุงูุนุฑุจู"></textarea>
        </div>
        <div class="form-group">
          <label>ุงููุต (ุฅูุฌููุฒู)</label>
          <textarea id="promoTextEn" placeholder="Offer details in English"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุดุนุงุฑ (Badge) - ุนุฑุจู</label>
          <input type="text" id="promoBadgeAr" placeholder="ุฎุตู 50%" />
        </div>
        <div class="form-group">
          <label>ุงูุดุนุงุฑ (Badge) - ุฅูุฌููุฒู</label>
          <input type="text" id="promoBadgeEn" placeholder="50% Off" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุฑุงุจุท ุตูุฑุฉ ุงูุนุฑุถ</label>
          <input type="text" id="promoImageURL" placeholder="ุฑุงุจุท ุตูุฑุฉ ุงูุนุฑุถ (ุฌูุฌู ุฏุฑูู ุฃู ุฑุงุจุท ูุจุงุดุฑ)" />
        </div>
        <div class="form-group">
          <label>ุงูุชุฑุชูุจ</label>
          <input type="number" id="promoOrder" value="0" min="0" />
        </div>
      </div>
      <button class="btn" onclick="addPromotion()" style="width: 100%; margin: 20px 0;">
        <i class="fas fa-tag"></i> ุฅุถุงูุฉ ุงูุนุฑุถ ุงูุชุฑููุฌู
      </button>
      <hr style="border: 1px solid #444; margin: 30px 0;" />
      <h3 style="margin: 2rem 0 1rem;">ุงูุนุฑูุถ ุงูุญุงููุฉ</h3>
      <!-- ุชู ุงูุชุนุฏูู ููุง: ุฅุถุงูุฉ class="items-grid" ูุฌุนู ุงูุนุฑุถ ูุฑููุง -->
      <div id="promotionsList" class="items-grid"></div>
    </div>
    <!-- 6. ุฅุตูุงุญ ุงูุจูุงูุงุช -->
    <div id="fix-data" class="tab-content">
      <h2>ุฅุตูุงุญ ูููููุฉ ุงูุจูุงูุงุช</h2>
      <p>ูููู ูุฐุง ุงูุฒุฑ ุจุฅุตูุงุญ ุฃู ูุดุงูู ูู ูููููุฉ ุชุฎุฒูู ุงูุฃุตูุงู.</p>
      <button class="btn fix-data-btn" onclick="fixDataStructure()">
        <i class="fas fa-tools"></i> ุฅุตูุงุญ ุงูุจูุงูุงุช
      </button>
      <div id="fixDataResult" class="debug-info"></div>
    </div>
  </div>
  <!-- ูุงูุฐุฉ ุงูุชุนุฏูู ุงูููุจุซูุฉ -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeEditModal()">&times;</span>
      <h2 class="modal-title">ุชุนุฏูู ุงูุตูู</h2>
      <div class="form-row">
        <div class="form-group">
          <label>ุงููุณู ุงูุฑุฆูุณู</label>
          <select id="editMainCat" onchange="loadEditSubCategories()"></select>
        </div>
        <div class="form-group">
          <label>ุงููุณู ุงููุฑุนู</label>
          <select id="editSubCat"></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุงุณู (ุนุฑุจู)</label>
          <input type="text" id="editNameAr" />
        </div>
        <div class="form-group">
          <label>ุงูุงุณู (ุฅูุฌููุฒู)</label>
          <input type="text" id="editNameEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงููุตู (ุนุฑุจู)</label>
          <textarea id="editDescAr"></textarea>
        </div>
        <div class="form-group">
          <label>ุงููุตู (ุฅูุฌููุฒู)</label>
          <textarea id="editDescEn"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุณุนุฑ</label>
          <input type="number" id="editPrice" step="0.5" />
        </div>
        <div class="form-group">
          <label>ุงูุฎุตู (%)</label>
          <input type="number" id="editDiscount" min="0" max="100" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุฑุงุจุท ุงูุตูุฑุฉ</label>
          <input type="text" id="editImageURL" />
        </div>
        <div class="form-group">
          <label>ุงูุญุงูุฉ</label>
          <select id="editAvailable">
            <option value="true">ูุชููุฑ</option>
            <option value="false">ุบูุฑ ูุชููุฑ</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <button class="btn" onclick="updateItem()">ุญูุธ ุงูุชุนุฏููุงุช</button>
        </div>
      </div>
      <input type="hidden" id="editItemKey">
      <input type="hidden" id="editOriginalMainCat">
      <input type="hidden" id="editOriginalSubCat">
    </div>
  </div>
  <!-- ูุงูุฐุฉ ุชุนุฏูู ุงูุนุฑุถ -->
  <div id="editPromoModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeEditPromoModal()">&times;</span>
      <h2 class="modal-title">ุชุนุฏูู ุงูุนุฑุถ</h2>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุนููุงู (ุนุฑุจู)</label>
          <input type="text" id="editPromoTitleAr" />
        </div>
        <div class="form-group">
          <label>ุงูุนููุงู (ุฅูุฌููุฒู)</label>
          <input type="text" id="editPromoTitleEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงููุต (ุนุฑุจู)</label>
          <textarea id="editPromoTextAr"></textarea>
        </div>
        <div class="form-group">
          <label>ุงููุต (ุฅูุฌููุฒู)</label>
          <textarea id="editPromoTextEn"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุดุนุงุฑ (ุนุฑุจู)</label>
          <input type="text" id="editPromoBadgeAr" />
        </div>
        <div class="form-group">
          <label>ุงูุดุนุงุฑ (ุฅูุฌููุฒู)</label>
          <input type="text" id="editPromoBadgeEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ุฑุงุจุท ุงูุตูุฑุฉ</label>
          <input type="text" id="editPromoImageURL" placeholder="ุฑุงุจุท ุตูุฑุฉ ุงูุนุฑุถ (ุฌูุฌู ุฏุฑูู ุฃู ุฑุงุจุท ูุจุงุดุฑ)" />
        </div>
        <div class="form-group">
          <label>ุงูุชุฑุชูุจ</label>
          <input type="number" id="editPromoOrder" min="0" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <button class="btn" onclick="updatePromotion()">ุชุญุฏูุซ ุงูุนุฑุถ</button>
        </div>
      </div>
      <input type="hidden" id="editPromoKey">
    </div>
  </div>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script>
    // โ ุชุนุฑูู ุงููุชุบูุฑุงุช ุฃูููุง
    let allItemsData = {};
    let selectedMainCategory = '';
    let selectedSubCategory = '';
    let auth, db;
    // ุชููุฆุฉ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDIs4dsxIk0xtuUaTGkIlVGKuFqwHBfr7g",
      authDomain: "app-da684.firebaseapp.com",
      databaseURL: "https://app-da684-default-rtdb.firebaseio.com",
      projectId: "app-da684",
      storageBucket: "app-da684.firebasestorage.app",
      messagingSenderId: "204039458597",
      appId: "1:204039458597:web:5be11d7494ac10cb3314cc"
    };
    try {
      firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      db = firebase.database();
      console.log("Firebase initialized successfully");
      updateDebugInfo("Firebase ูููุฃ ุจูุฌุงุญ", "success");
    } catch (error) {
      console.error("Firebase initialization error:", error);
      updateDebugInfo("ุฎุทุฃ ูู ุชููุฆุฉ Firebase: " + error.message, "error");
    }
    function updateDebugInfo(message, type = "info") {
      const debugInfo = document.getElementById("debugInfo");
      if (debugInfo) {
        debugInfo.innerHTML = `ุญุงูุฉ ุงูุงุชุตุงู: ${message}`;
        debugInfo.style.color = type === "error" ? "red" : type === "success" ? "green" : "white";
      }
    }
    // ุฏุงูุฉ ุชุญููู ุฑูุงุจุท ุฌูุฌู ุฏุฑูู ุฅูู ุฑูุงุจุท ูุจุงุดุฑุฉ
    function convertGoogleDriveURL(url) {
      if (!url) return '';
      // ุฅุฐุง ูุงู ุงูุฑุงุจุท ูุญุชูู ุนูู ูุนุฑู ุงูููู ูุจุงุดุฑุฉ (ูุซู ุงููุซุงู ุงูุฐู ุฐูุฑุชู)
      if (url.includes('lh3.googleusercontent.com')) {
        return url; // ุงูุฑุงุจุท ุงููุจุงุดุฑ ุจุงููุนู
      }
      // ุฅุฐุง ูุงู ุงูุฑุงุจุท ูู ููุน ูุดุงุฑูุฉ ุฌูุฌู ุฏุฑูู
      if (url.includes('drive.google.com')) {
        // ุงุณุชุฎุฑุงุฌ ูุนุฑู ุงูููู ูู ุงูุฑุงุจุท
        const match = url.match(/\/d\/([^\/]+)/);
        if (match && match[1]) {
          return `https://lh3.googleusercontent.com/d/${match[1]}=s0`;
        }
        // ูุญุงููุฉ ุฃุฎุฑู ูุงุณุชุฎุฑุงุฌ ุงููุนุฑู ูู ุฃููุงุน ุฑูุงุจุท ุฃุฎุฑู
        const altMatch = url.match(/id=([^&]+)/);
        if (altMatch && altMatch[1]) {
          return `https://lh3.googleusercontent.com/d/${altMatch[1]}=s0`;
        }
      }
      // ุฅุฐุง ูู ููู ุฑุงุจุท ุฌูุฌู ุฏุฑููุ ุฅุฑุฌุงุน ุงูุฑุงุจุท ููุง ูู
      return url;
    }
    // ุงูุชุจููุจุงุช
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.getAttribute('data-tab');
        document.getElementById(tab).classList.add('active');
        if (tab === 'categories') loadMainCategoriesForSub();
        if (tab === 'manage-items') loadAllItems();
        if (tab === 'orders') loadOrders();
        if (tab === 'promotions') loadPromotions();
      });
    });
    // ุชุณุฌูู ุงูุฏุฎูู
    function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const error = document.getElementById("loginError");
      error.textContent = "";
      if (!email || !password) {
        error.textContent = "ุงููุฃ ุฌููุน ุงูุญููู";
        return;
      }
      updateDebugInfo("ุฌุงุฑู ุชุณุฌูู ุงูุฏุฎูู...");
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          loginPage.style.display = "none";
          dashboard.style.display = "block";
          loadMainCategoriesForSub();
          loadMainCategoriesForItem();
          loadAllItems();
          checkDatabaseConnection();
        })
        .catch(err => {
          error.textContent = "ุฎุทุฃ: " + err.message;
          updateDebugInfo("ุฎุทุฃ ูู ุงูุชุณุฌูู: " + err.message, "error");
        });
    }
    function logout() {
      auth.signOut().then(() => {
        dashboard.style.display = "none";
        loginPage.style.display = "flex";
        updateDebugInfo("ุชู ุชุณุฌูู ุงูุฎุฑูุฌ");
      });
    }
    function checkDatabaseConnection() {
      if (!db) return;
      db.ref('.info/connected').on('value', (snapshot) => {
        updateDebugInfo(snapshot.val() ? "ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช" : "ุบูุฑ ูุชุตู", snapshot.val() ? "success" : "error");
      });
    }
    // ุฏุงูุฉ ุชุญููู ุฑูุงุจุท ุฌูุฌู ุฏุฑูู ููุนุฑุถ
    function getDirectImageURL(url) {
      if (!url) return 'https://via.placeholder.com/300x200/222/D4AF37?text=No+Image';
      try {
        if (url.includes('drive.google.com')) {
          const idMatch = url.match(/\/d\/([^\/]+)/);
          if (idMatch && idMatch[1]) {
            return `https://drive.google.com/uc?export=view&id=${idMatch[1]}`;
          }
        }
        return url;
      } catch (e) {
        return 'https://via.placeholder.com/300x200/222/D4AF37?text=Error';
      }
    }
    // ุฅุถุงูุฉ ูุณู ุฑุฆูุณู
    function addMainCategory() {
      const name = document.getElementById("mainCatName").value.trim();
      if (!name) return alert("ุฃุฏุฎู ุงุณู ุงููุณู");
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงููุชุงุจุฉ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      db.ref('menuItems/' + name).set({ type: "mainCategory" })
        .then(() => {
          alert("ุชู ุงูุฅุถุงูุฉ: " + name);
          document.getElementById("mainCatName").value = "";
          loadMainCategoriesForSub();
          loadMainCategoriesForItem();
        })
        .catch(err => alert("ุฎุทุฃ: " + err.message));
    }
    // ุชุญููู ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ
    function loadMainCategoriesForSub() {
      const select = document.getElementById("mainCatSelect");
      select.innerHTML = "<option value=''>ุงุฎุชุฑ ูุณู ุฑุฆูุณู</option>";
      // ูููู ุชุญููู ุงูุฃูุณุงู ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ูุณุฌูุงู (ูููุฑุงุกุฉ ุงูุนุงูุฉ)
      db.ref('menuItems').once('value').then(snapshot => {
        snapshot.forEach(snap => {
          if (snap.key !== 'type') {
            const opt = document.createElement("option");
            opt.value = snap.key;
            opt.textContent = snap.key;
            select.appendChild(opt);
          }
        });
      }).catch(err => {
        console.error("ูุดู ุชุญููู ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ:", err);
        alert("ุฎุทุฃ ูู ุชุญููู ุงูุฃูุณุงู: " + err.message);
      });
    }
    // ุฅุถุงูุฉ ูุณู ูุฑุนู
    function addSubCategory() {
      const main = document.getElementById("mainCatSelect").value;
      const sub = document.getElementById("subCatName").value.trim();
      if (!main || !sub) return alert("ุงุฎุชุฑ ุงููุณู ุงูุฑุฆูุณู ูุฃุฏุฎู ุงุณู ุงููุณู ุงููุฑุนู");
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงููุชุงุจุฉ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      db.ref('menuItems/' + main + '/' + sub).set({ type: "subCategory" })
        .then(() => {
          alert("ุชู ุฅุถุงูุฉ: " + sub);
          document.getElementById("subCatName").value = "";
          loadMainCategoriesForItem();
        })
        .catch(err => alert("ุฎุทุฃ: " + err.message));
    }
    // ุชุญููู ุงูุฃูุณุงู ุนูุฏ ุฅุถุงูุฉ ุตูู
    function loadMainCategoriesForItem() {
      const select = document.getElementById("addItemMainCat");
      select.innerHTML = "<option value=''>ุงุฎุชุฑ ูุณู ุฑุฆูุณู</option>";
      // ูููู ุชุญููู ุงูุฃูุณุงู ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ูุณุฌูุงู (ูููุฑุงุกุฉ ุงูุนุงูุฉ)
      db.ref('menuItems').once('value').then(snapshot => {
        snapshot.forEach(snap => {
          if (snap.key !== 'type') {
            const opt = document.createElement("option");
            opt.value = snap.key;
            opt.textContent = snap.key;
            select.appendChild(opt);
          }
        });
        loadSubCategoriesForItem();
      }).catch(err => {
        console.error("ูุดู ุชุญููู ุงูุฃูุณุงู ููุฅุถุงูุฉ:", err);
      });
    }
    function loadSubCategoriesForItem() {
      const main = document.getElementById("addItemMainCat").value;
      const select = document.getElementById("addItemSubCat");
      select.innerHTML = "<option value=''>ุงุฎุชุฑ ูุณู ูุฑุนู</option>";
      if (!main) return;
      // ูููู ุชุญููู ุงูุฃูุณุงู ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ูุณุฌูุงู (ูููุฑุงุกุฉ ุงูุนุงูุฉ)
      db.ref('menuItems/' + main).once('value').then(snapshot => {
        snapshot.forEach(subSnap => {
          if (subSnap.key !== 'type') {
            const opt = document.createElement("option");
            opt.value = subSnap.key;
            opt.textContent = subSnap.key;
            select.appendChild(opt);
          }
        });
      }).catch(err => {
        console.error("ูุดู ุชุญููู ุงูุฃูุณุงู ุงููุฑุนูุฉ:", err);
      });
    }
    // --- ุฏุงูุฉ ุฅุถุงูุฉ ุตูู ููุท --- //
    function addItemOnly() {
      const mainCat = document.getElementById("addItemMainCat").value;
      const subCat = document.getElementById("addItemSubCat").value;
      const nameAr = document.getElementById("itemNameAr").value.trim();
      const nameEn = document.getElementById("itemNameEn").value.trim();
      const descAr = document.getElementById("itemDescAr").value;
      const descEn = document.getElementById("itemDescEn").value;
      const price = parseFloat(document.getElementById("itemPrice").value);
      const discount = parseInt(document.getElementById("itemDiscount").value) || 0;
      let imageURL = document.getElementById("itemImageURL").value.trim();
      if (!mainCat || !subCat || !nameAr || !nameEn || isNaN(price)) {
        return alert("ุงููุฃ ุฌููุน ุงูุญููู ุงููุทููุจุฉ");
      }
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงููุชุงุจุฉ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      imageURL = convertGoogleDriveURL(imageURL);
      const newItem = {
        nameAr, nameEn,
        descriptionAr: descAr,
        descriptionEn: descEn,
        price,
        discount,
        imageURL,
        available: true,
        categoryAr: subCat,
        categoryEn: getEnglishCategory(subCat),
        createdAt: firebase.database.ServerValue.TIMESTAMP
      };
      const newItemKey = firebase.database().ref().child('menuItems').push().key;
      const updates = {};
      updates[`menuItems/${mainCat}/${subCat}/${newItemKey}`] = newItem;
      db.ref().update(updates)
        .then(() => {
          alert("ุชู ุฅุถุงูุฉ ุงูุตูู ุจูุฌุงุญ");
          // ูุณุญ ุงูุญููู
          document.getElementById("itemNameAr").value = "";
          document.getElementById("itemNameEn").value = "";
          document.getElementById("itemDescAr").value = "";
          document.getElementById("itemDescEn").value = "";
          document.getElementById("itemPrice").value = "";
          document.getElementById("itemDiscount").value = "0";
          document.getElementById("itemImageURL").value = "";
        })
        .catch(err => {
          console.error("ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุตูู:", err);
          alert("ุฎุทุฃ: " + err.message);
        });
    }
    // ุชุญููู ุงูุฃุตูุงู
    function loadAllItems() {
      const container = document.getElementById("itemsContainer");
      container.innerHTML = '<div class="loading">ุฌุงุฑู ุงูุชุญููู...</div>';
      // ูููู ุชุญููู ุงูุฃุตูุงู ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ูุณุฌูุงู (ูููุฑุงุกุฉ ุงูุนุงูุฉ)
      db.ref('menuItems').once('value')
        .then(snapshot => {
          const data = snapshot.val();
          if (!data) {
            container.innerHTML = '<p class="no-items">ูุง ุชูุฌุฏ ุฃุตูุงู ุจุนุฏ.</p>';
            allItemsData = {};
            renderFilterButtons();
            return;
          }
          allItemsData = data;
          renderFilterButtons();
          filterItems();
        })
        .catch(err => {
          console.error("ุฎุทุฃ ูู ุชุญููู ุงูุฃุตูุงู:", err);
          container.innerHTML = `<div class="error">ูุดู ุงูุชุญููู: ${err.message}</div>`;
        });
    }
    function renderFilterButtons() {
      const mainFilter = document.getElementById('mainCategoriesFilter');
      const subFilter = document.getElementById('subCategoriesFilter');
      mainFilter.innerHTML = '<button class="filter-btn active" data-category="">ุฌููุน ุงูุฃูุณุงู</button>';
      subFilter.innerHTML = '<button class="filter-btn active" data-subcategory="">ุฌููุน ุงููุฆุงุช</button>';
      Object.keys(allItemsData).forEach(cat => {
        if (cat !== 'type') {
          const btn = document.createElement('button');
          btn.className = 'filter-btn';
          btn.setAttribute('data-category', cat);
          btn.textContent = cat;
          btn.onclick = () => filterByMainCategory(cat);
          mainFilter.appendChild(btn);
        }
      });
    }
    function filterByMainCategory(mainCat) {
      selectedMainCategory = mainCat;
      selectedSubCategory = '';
      document.querySelectorAll('#mainCategoriesFilter .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-category') === mainCat);
      });
      const subFilter = document.getElementById('subCategoriesFilter');
      subFilter.innerHTML = '<button class="filter-btn active" data-subcategory="">ุฌููุน ุงููุฆุงุช</button>';
      const mainCatData = allItemsData[mainCat] || {};
      Object.keys(mainCatData).forEach(sub => {
        if (sub !== 'type') {
          const btn = document.createElement('button');
          btn.className = 'filter-btn';
          btn.setAttribute('data-subcategory', sub);
          btn.textContent = sub;
          btn.onclick = () => filterBySubCategory(sub);
          subFilter.appendChild(btn);
        }
      });
      filterItems();
    }
    function filterBySubCategory(subCat) {
      selectedSubCategory = subCat;
      document.querySelectorAll('#subCategoriesFilter .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-subcategory') === subCat);
      });
      filterItems();
    }
    function filterItems() {
      const container = document.getElementById("itemsContainer");
      const searchTerm = document.getElementById("searchInput")?.value.trim().toLowerCase() || '';
      const availabilityFilter = document.getElementById("availabilityFilter")?.value; // "" | "true" | "false"
      container.innerHTML = '';
      let hasItems = false;
      Object.keys(allItemsData).forEach(mainCat => {
        if (mainCat === 'type') return;
        if (!selectedMainCategory || mainCat === selectedMainCategory) {
          const mainCatData = allItemsData[mainCat];
          let mainHasItems = false;
          const mainDiv = document.createElement('div');
          Object.keys(mainCatData).forEach(subCat => {
            if (subCat === 'type') return;
            if (!selectedSubCategory || subCat === selectedSubCategory) {
              const items = mainCatData[subCat];
              if (!items || typeof items !== 'object') return;
              let subHasItems = false;
              const subHeader = document.createElement('h3');
              subHeader.className = 'category-header';
              subHeader.textContent = `${subCat} (ุชุญุช: ${mainCat})`;
              const grid = document.createElement('div');
              grid.className = 'items-grid';
              Object.keys(items).forEach(key => {
                if (key === 'type') return;
                const item = items[key];
                if (typeof item !== 'object' || !item.nameAr) return;
                // ุงูุชุญูู ูู ุงูุจุญุซ
                const matchesSearch = 
                  !searchTerm || 
                  item.nameAr.toLowerCase().includes(searchTerm) || 
                  item.nameEn.toLowerCase().includes(searchTerm);
                // ุงูุชุญูู ูู ุงูุชููุฑ
                const matchesAvailability = 
                  availabilityFilter === "" || 
                  item.available?.toString() === availabilityFilter;
                if (matchesSearch && matchesAvailability) {
                  const card = createItemCard(mainCat, subCat, key, item);
                  grid.appendChild(card);
                  hasItems = true;
                  mainHasItems = true;
                  subHasItems = true;
                }
              });
              if (subHasItems) {
                mainDiv.appendChild(subHeader);
                mainDiv.appendChild(grid);
              }
            }
          });
          if (mainHasItems) container.appendChild(mainDiv);
        }
      });
      if (!hasItems) {
        container.innerHTML = "<p class='no-items'>ูุง ุชูุฌุฏ ุฃุตูุงู ูุทุงุจูุฉ ููุจุญุซ ุฃู ุงูููุชุฑุฉ.</p>";
      }
    }
    function createItemCard(mainCat, subCat, key, item) {
      const card = document.createElement('div');
      card.className = 'item-card';
      const img = getDirectImageURL(item.imageURL);
      card.innerHTML = `
        <img src="${img}" alt="${item.nameAr}" class="item-image" onerror="this.src='https://via.placeholder.com/300x200/222/D4AF37?text=No+Image'">
        <div class="item-details">
          <div class="item-name">${item.nameAr}</div>
          <div class="item-description">${item.descriptionAr || 'ูุง ููุฌุฏ ูุตู'}</div>
          <div class="item-price">ุงูุณุนุฑ: ${item.price} ุฌ.ู</div>
          ${item.discount > 0 ? `<div class="item-discount">ุงูุฎุตู: ${item.discount}%</div>` : ''}
          <div class="item-actions">
            <button class="action-btn edit-btn" onclick="openEditModal('${mainCat}', '${subCat}', '${key}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
              <i class="fas fa-edit"></i> ุชุนุฏูู
            </button>
            <button class="action-btn delete-btn" onclick="deleteItem('${mainCat}', '${subCat}', '${key}')">
              <i class="fas fa-trash"></i> ุญุฐู
            </button>
          </div>
        </div>
      `;
      return card;
    }
    // ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
    function loadOrders() {
      const tbody = document.getElementById("ordersTableBody");
      tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 20px;">ุฌุงุฑู ุชุญููู ุงูุทูุจุงุช...</td></tr>';
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุชุญููู ุงูุทูุจุงุช (ููุฎุตูุตูุฉ)
      if (!auth.currentUser) {
        tbody.innerHTML = '<tr><td colspan="7" style="color:red; text-align:center;">ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุคูุฉ ุงูุทูุจุงุช.</td></tr>';
        return;
      }
      db.ref('orders').orderByChild('timestamp').once('value')
        .then(snapshot => {
          const orders = snapshot.val();
          tbody.innerHTML = '';
          if (!orders || Object.keys(orders).length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 20px;">ูุง ุชูุฌุฏ ุทูุจุงุช.</td></tr>';
            return;
          }
          Object.entries(orders).reverse().forEach(([orderId, order]) => {
            const date = order.timestamp ? new Date(order.timestamp).toLocaleString('ar') : 'ุบูุฑ ูุนุฑูู';
            const itemsHTML = (order.items || []).map(item => `${item.nameAr} ร ${item.quantity}`).join('<br>');
            const tr = document.createElement('tr');
            tr.setAttribute('data-order-id', orderId);
            tr.setAttribute('data-status', order.status || '');
            tr.innerHTML = `
              <td>${orderId.replace('JMR-', '')}</td>
              <td>${date}</td>
              <td style="font-weight: bold; color: var(--primary);">${order.tableNumber || '?'}</td>
              <td style="font-size: 0.9rem;">${itemsHTML}</td>
              <td>${(order.total || 0).toFixed(2)} ุฌ.ู</td>
              <td>
                <select class="order-status-select" onchange="updateOrderStatus('${orderId}', this.value)">
                  <option value="ููุฏ ุงูุชุญุถูุฑ" ${order.status === 'ููุฏ ุงูุชุญุถูุฑ' ? 'selected' : ''}>ููุฏ ุงูุชุญุถูุฑ</option>
                  <option value="ุฌุงูุฒ ููุชูุฏูู" ${order.status === 'ุฌุงูุฒ ููุชูุฏูู' ? 'selected' : ''}>ุฌุงูุฒ</option>
                  <option value="ุชู ุงูุชุณููู" ${order.status === 'ุชู ุงูุชุณููู' ? 'selected' : ''}>ุชู ุงูุชุณููู</option>
                </select>
              </td>
              <td>
                <button class="btn" style="background:var(--success)" onclick="completeOrder('${orderId}')">ุชู ุงูุงุณุชูุงู</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
          filterOrdersByStatus();
        })
        .catch(err => {
          tbody.innerHTML = `<tr><td colspan="7" style="color:red; text-align:center;">ุฎุทุฃ: ${err.message}</td></tr>`;
        });
    }
    function updateOrderStatus(orderId, newStatus) {
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงูุชุญุฏูุซ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      db.ref('orders/' + orderId).update({ status: newStatus })
        .then(() => {
          if (newStatus === "ุชู ุงูุชุณููู") {
            const row = document.querySelector(`tr[data-order-id="${orderId}"]`);
            if (row) {
              row.style.transition = "opacity 0.5s";
              row.style.opacity = "0";
              setTimeout(() => row.remove(), 500);
            }
          }
          showNotification("ุชู ุงูุชุญุฏูุซ");
        })
        .catch(err => alert("ุฎุทุฃ: " + err.message));
    }
    function completeOrder(orderId) {
      if (!confirm("ูู ุชุฃูุฏ ูู ุงุณุชูุงู ูุฐุง ุงูุทูุจุ")) return;
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงูุชุญุฏูุซ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      db.ref('orders/' + orderId).update({ status: "ุชู ุงูุชุณููู" })
        .then(() => {
          const row = document.querySelector(`tr[data-order-id="${orderId}"]`);
          if (row) {
            row.style.transition = "opacity 0.5s";
            row.style.opacity = "0";
            setTimeout(() => row.remove(), 500);
          }
          showNotification("ุชู ุงูุชุณููู");
        })
        .catch(err => alert("ุฎุทุฃ: " + err.message));
    }
    function filterOrdersByStatus() {
      const selectedStatus = document.querySelector('#statusFilter .filter-btn.active')?.getAttribute('data-status') || '';
      document.querySelectorAll('#ordersTableBody tr').forEach(tr => {
        const status = tr.getAttribute('data-status');
        tr.style.display = !selectedStatus || selectedStatus === status ? '' : 'none';
      });
    }
    // ุฅุนุฏุงุฏ ุชุตููุฉ ุงูุทูุจุงุช
    document.querySelectorAll('#statusFilter .filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#statusFilter .filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        filterOrdersByStatus();
      });
    });
    function showNotification(message) {
      const n = document.createElement('div');
      n.textContent = message;
      n.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#D4AF37;color:#000;padding:1rem 2rem;border-radius:30px;z-index:1000;animation:fadeInOut 3s forwards;';
      document.body.appendChild(n);
      setTimeout(() => n.remove(), 3000);
    }
    function openEditModal(mainCat, subCat, key, item) {
      document.getElementById('editOriginalMainCat').value = mainCat;
      document.getElementById('editOriginalSubCat').value = subCat;
      document.getElementById('editItemKey').value = key;
      document.getElementById('editNameAr').value = item.nameAr || '';
      document.getElementById('editNameEn').value = item.nameEn || '';
      document.getElementById('editDescAr').value = item.descriptionAr || '';
      document.getElementById('editDescEn').value = item.descriptionEn || '';
      document.getElementById('editPrice').value = item.price || '';
      document.getElementById('editDiscount').value = item.discount || 0;
      document.getElementById('editImageURL').value = item.imageURL || '';
      document.getElementById('editAvailable').value = item.available ? 'true' : 'false';
      const mainSelect = document.getElementById('editMainCat');
      mainSelect.innerHTML = '<option value="">ุงุฎุชุฑ ูุณู ุฑุฆูุณู</option>';
      // ูููู ุชุญููู ุงูุฃูุณุงู ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ูุณุฌูุงู (ูููุฑุงุกุฉ ุงูุนุงูุฉ)
      db.ref('menuItems').once('value').then(snapshot => {
        snapshot.forEach(snap => {
          if (snap.key !== 'type') {
            const opt = document.createElement('option');
            opt.value = snap.key;
            opt.textContent = snap.key;
            opt.selected = (snap.key === mainCat);
            mainSelect.appendChild(opt);
          }
        });
        loadEditSubCategories(subCat);
      });
      document.getElementById('editModal').style.display = 'block';
    }
    function loadEditSubCategories(subCatToSelect) {
      const mainCat = document.getElementById('editMainCat').value;
      const subSelect = document.getElementById('editSubCat');
      subSelect.innerHTML = '<option value="">ุงุฎุชุฑ ูุณู ูุฑุนู</option>';
      if (!mainCat) return;
      // ูููู ุชุญููู ุงูุฃูุณุงู ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ูุณุฌูุงู (ูููุฑุงุกุฉ ุงูุนุงูุฉ)
      db.ref('menuItems/' + mainCat).once('value').then(snapshot => {
        snapshot.forEach(subSnap => {
          if (subSnap.key !== 'type') {
            const opt = document.createElement('option');
            opt.value = subSnap.key;
            opt.textContent = subSnap.key;
            if (subCatToSelect && subSnap.key === subCatToSelect) opt.selected = true;
            subSelect.appendChild(opt);
          }
        });
      });
    }
    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }
    // ุชุญุฏูุซ ุงูุตูู ูุน ุชุญููู ุฑุงุจุท ุงูุตูุฑุฉ
    function updateItem() {
      const origMain = document.getElementById('editOriginalMainCat').value;
      const origSub = document.getElementById('editOriginalSubCat').value;
      const key = document.getElementById('editItemKey').value;
      const mainCat = document.getElementById('editMainCat').value;
      const subCat = document.getElementById('editSubCat').value;
      const nameAr = document.getElementById('editNameAr').value.trim();
      const nameEn = document.getElementById('editNameEn').value.trim();
      const price = parseFloat(document.getElementById('editPrice').value);
      let imageURL = document.getElementById('editImageURL').value.trim();
      if (!mainCat || !subCat || !nameAr || !nameEn || isNaN(price)) return alert("ุงููุฃ ุฌููุน ุงูุญููู");
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงูุชุญุฏูุซ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      // ุชุญููู ุฑุงุจุท ุฌูุฌู ุฏุฑูู ุฅูู ุฑุงุจุท ูุจุงุดุฑ ุฅุฐุง ูุงู ูู ุฌูุฌู ุฏุฑูู
      imageURL = convertGoogleDriveURL(imageURL);
      const updated = {
        nameAr, nameEn,
        descriptionAr: document.getElementById('editDescAr').value,
        descriptionEn: document.getElementById('editDescEn').value,
        price, 
        discount: parseInt(document.getElementById('editDiscount').value) || 0,
        imageURL: imageURL,
        available: document.getElementById('editAvailable').value === 'true',
        categoryAr: subCat,
        categoryEn: getEnglishCategory(subCat)
      };
      if (origMain !== mainCat || origSub !== subCat) {
        db.ref('menuItems/' + origMain + '/' + origSub + '/' + key).remove()
          .then(() => db.ref('menuItems/' + mainCat + '/' + subCat + '/' + key).set(updated))
          .then(() => { 
            alert("ุชู ุงูููู ูุงูุชุญุฏูุซ"); 
            closeEditModal(); 
            loadAllItems(); 
          })
          .catch(err => alert("ุฎุทุฃ: " + err.message));
      } else {
        db.ref('menuItems/' + mainCat + '/' + subCat + '/' + key).update(updated)
          .then(() => { 
            alert("ุชู ุงูุชุญุฏูุซ"); 
            closeEditModal(); 
            loadAllItems(); 
          })
          .catch(err => alert("ุฎุทุฃ: " + err.message));
      }
    }
    function deleteItem(mainCat, subCat, key) {
      if (confirm("ุญุฐู ูุฐุง ุงูุตููุ")) {
        // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงูุญุฐู
        if (!auth.currentUser) {
          alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
          return;
        }
        db.ref('menuItems/' + mainCat + '/' + subCat + '/' + key).remove()
          .then(() => { 
            alert("ุชู ุงูุญุฐู"); 
            loadAllItems(); 
          })
          .catch(err => alert("ุฎุทุฃ: " + err.message));
      }
    }
    // --- ุฅุฏุงุฑุฉ ุงูุนุฑูุถ ---
    function addPromotion() {
      const titleAr = document.getElementById("promoTitleAr").value.trim();
      const titleEn = document.getElementById("promoTitleEn").value.trim();
      const textAr = document.getElementById("promoTextAr").value.trim();
      const textEn = document.getElementById("promoTextEn").value.trim();
      const badgeAr = document.getElementById("promoBadgeAr").value.trim();
      const badgeEn = document.getElementById("promoBadgeEn").value.trim();
      let image = document.getElementById("promoImageURL").value.trim();
      const order = parseInt(document.getElementById("promoOrder").value) || 0;
      if (!titleAr || !titleEn || !textAr || !textEn || !image) {
        alert("ุงููุฃ ุงูุญููู ุงููุทููุจุฉ");
        return;
      }
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงููุชุงุจุฉ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      // ุชุญููู ุฑุงุจุท ุฌูุฌู ุฏุฑูู ุฅูู ุฑุงุจุท ูุจุงุดุฑ ุฅุฐุง ูุงู ูู ุฌูุฌู ุฏุฑูู
      image = convertGoogleDriveURL(image);
      const promo = {
        titleAr, titleEn,
        textAr, textEn,
        badgeAr, badgeEn,
        image,
        order,
        createdAt: firebase.database.ServerValue.TIMESTAMP
      };
      const newKey = db.ref().push().key;
      db.ref('promotions/' + newKey).set(promo)
        .then(() => {
          alert("ุชู ุฅุถุงูุฉ ุงูุนุฑุถ");
          document.getElementById("promoTitleAr").value = "";
          document.getElementById("promoTitleEn").value = "";
          document.getElementById("promoTextAr").value = "";
          document.getElementById("promoTextEn").value = "";
          document.getElementById("promoBadgeAr").value = "";
          document.getElementById("promoBadgeEn").value = "";
          document.getElementById("promoImageURL").value = "";
          document.getElementById("promoOrder").value = "0";
          loadPromotions();
        })
        .catch(err => alert("ุฎุทุฃ: " + err.message));
    }
    function loadPromotions() {
      const container = document.getElementById("promotionsList");
      container.innerHTML = '<div class="loading">ุฌุงุฑู ุงูุชุญููู...</div>';
      // ูููู ุชุญููู ุงูุนุฑูุถ ุญุชู ูู ูู ููู ุงููุณุชุฎุฏู ูุณุฌูุงู (ูููุฑุงุกุฉ ุงูุนุงูุฉ)
      db.ref('promotions').orderByChild('order').once('value').then(snapshot => {
        const data = snapshot.val();
        if (!data) {
          container.innerHTML = '<div class="debug-info">ูุง ุชูุฌุฏ ุนุฑูุถ</div>';
          return;
        }
        container.innerHTML = '';
        Object.keys(data).forEach(key => {
          const promo = data[key];
          const div = document.createElement('div');
          div.className = 'item-card';
          div.innerHTML = `
            <img src="${getDirectImageURL(promo.image)}" alt="${promo.titleAr}" class="item-image" onerror="this.src='https://via.placeholder.com/300x200/222/D4AF37?text=No+Image'">
            <div class="item-details">
              <div class="item-name">${promo.titleAr}</div>
              <div class="item-description">${promo.textAr}</div>
              ${promo.badgeAr ? `<div class="promo-badge">${promo.badgeAr}</div>` : ''}
              <div class="item-price">ุงูุชุฑุชูุจ: ${promo.order}</div>
            </div>
            <div class="item-actions">
              <button class="action-btn edit-btn" onclick="openEditPromoModal('${key}', ${JSON.stringify(promo).replace(/"/g, '&quot;')})">
                <i class="fas fa-edit"></i> ุชุนุฏูู
              </button>
              <button class="action-btn delete-btn" onclick="deletePromotion('${key}')">
                <i class="fas fa-trash"></i> ุญุฐู
              </button>
            </div>
          `;
          container.appendChild(div);
        });
      }).catch(error => {
        console.error("Error loading promotions:", error);
        container.innerHTML = `<div class="error">ุฎุทุฃ ูู ุชุญููู ุงูุนุฑูุถ: ${error.message}</div>`;
      });
    }
    function openEditPromoModal(key, promo) {
      document.getElementById("editPromoKey").value = key;
      document.getElementById("editPromoTitleAr").value = promo.titleAr || '';
      document.getElementById("editPromoTitleEn").value = promo.titleEn || '';
      document.getElementById("editPromoTextAr").value = promo.textAr || '';
      document.getElementById("editPromoTextEn").value = promo.textEn || '';
      document.getElementById("editPromoBadgeAr").value = promo.badgeAr || '';
      document.getElementById("editPromoBadgeEn").value = promo.badgeEn || '';
      document.getElementById("editPromoImageURL").value = promo.image || '';
      document.getElementById("editPromoOrder").value = promo.order || 0;
      document.getElementById("editPromoModal").style.display = 'block';
    }
    function closeEditPromoModal() {
      document.getElementById("editPromoModal").style.display = 'none';
    }
    function updatePromotion() {
      const key = document.getElementById("editPromoKey").value;
      const titleAr = document.getElementById("editPromoTitleAr").value.trim();
      const titleEn = document.getElementById("editPromoTitleEn").value.trim();
      const textAr = document.getElementById("editPromoTextAr").value.trim();
      const textEn = document.getElementById("editPromoTextEn").value.trim();
      const badgeAr = document.getElementById("editPromoBadgeAr").value.trim();
      const badgeEn = document.getElementById("editPromoBadgeEn").value.trim();
      let image = document.getElementById("editPromoImageURL").value.trim();
      const order = parseInt(document.getElementById("editPromoOrder").value) || 0;
      if (!titleAr || !titleEn || !textAr || !textEn || !image) {
        alert("ุงููุฃ ุงูุญููู ุงููุทููุจุฉ");
        return;
      }
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงูุชุญุฏูุซ
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      // ุชุญููู ุฑุงุจุท ุฌูุฌู ุฏุฑูู ุฅูู ุฑุงุจุท ูุจุงุดุฑ ุฅุฐุง ูุงู ูู ุฌูุฌู ุฏุฑูู
      image = convertGoogleDriveURL(image);
      const updates = {
        titleAr, titleEn,
        textAr, textEn,
        badgeAr, badgeEn,
        image,
        order
      };
      db.ref('promotions/' + key).update(updates)
        .then(() => {
          alert("ุชู ุชุญุฏูุซ ุงูุนุฑุถ");
          closeEditPromoModal();
          loadPromotions();
        })
        .catch(err => alert("ุฎุทุฃ: " + err.message));
    }
    function deletePromotion(key) {
      if (confirm("ุญุฐู ูุฐุง ุงูุนุฑุถุ")) {
        // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงูุญุฐู
        if (!auth.currentUser) {
          alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
          return;
        }
        db.ref('promotions/' + key).remove()
          .then(() => {
            alert("ุชู ุงูุญุฐู");
            loadPromotions();
          })
          .catch(err => alert("ุฎุทุฃ: " + err.message));
      }
    }
    function fixDataStructure() {
      const result = document.getElementById('fixDataResult');
      result.innerHTML = "ุฌุงุฑู ุงูุฅุตูุงุญ...";
      // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุจู ุงูุฅุตูุงุญ (ุนูููุฉ ูุชุงุจุฉ)
      if (!auth.currentUser) {
        alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
        return;
      }
      db.ref('menuItems').once('value').then(snapshot => {
        const data = snapshot.val() || {};
        let fixed = 0;
        Object.keys(data).forEach(main => {
          if (main !== 'type') {
            Object.keys(data[main]).forEach(sub => {
              if (sub !== 'type' && data[main][sub] && data[main][sub].nameAr !== undefined) {
                const itemKey = db.ref().push().key;
                const updates = {};
                updates[`menuItems/${main}/${sub}/${itemKey}`] = data[main][sub];
                updates[`menuItems/${main}/${sub}/type`] = "subCategory";
                Object.keys(data[main][sub]).forEach(k => {
                  if (k !== 'type' && k !== 'createdAt') updates[`menuItems/${main}/${sub}/${k}`] = null;
                });
                db.ref().update(updates).then(() => fixed++);
              }
            });
          }
        });
        setTimeout(() => {
          result.innerHTML = `ุชู ุฅุตูุงุญ ${fixed} ูู ุงูุนูุงุตุฑ.`;
        }, 1000);
      });
    }
    // ุฏุงูุฉ ูุณุงุนุฏุฉ ููุญุตูู ุนูู ุงุณู ุงููุณู ุจุงูุฅูุฌููุฒูุฉ
    function getEnglishCategory(arabicCategory) {
      const categoryMap = {
        'ูุฃูููุงุช': 'Food',
        'ูุดุฑูุจุงุช': 'Drinks',
        'ุญูููุงุช': 'Desserts',
        'ููุจูุงุช': 'Appetizers',
        'ุณูุทุงุช': 'Salads',
        'ุจูุชุฒุง': 'Pizza',
        'ุจุฑุฌุฑ': 'Burger',
        'ูุนุฌูุงุช': 'Pastries',
        'ูููุฉ': 'Coffee',
        'ุนุตุงุฆุฑ': 'Juices',
        'ุดุงู': 'Tea'
      };
      return categoryMap[arabicCategory] || arabicCategory;
    }
    // ุงูุชุนุงูู ูุน ุญุงูุฉ ุงููุตุงุฏูุฉ
    auth.onAuthStateChanged(user => {
      if (user) {
        loginPage.style.display = "none";
        dashboard.style.display = "block";
        loadMainCategoriesForSub();
        loadMainCategoriesForItem();
        loadAllItems();
        checkDatabaseConnection();
      } else {
        dashboard.style.display = "none";
        loginPage.style.display = "flex";
        updateDebugInfo("ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู");
      }
    });
    // ุฅุบูุงู ุงูููุงูุฐ ุงูููุจุซูุฉ ุจุงูููุฑ ุฎุงุฑุฌูุง
    window.onclick = e => {
      if (e.target === document.getElementById('editModal')) closeEditModal();
      if (e.target === document.getElementById('editPromoModal')) closeEditPromoModal();
    };
  </script>
</body>
</html>