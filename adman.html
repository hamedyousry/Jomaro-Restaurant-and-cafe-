<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- ØªØ±Ù…ÙŠØ² Ø§Ù„Ø£Ø­Ø±Ù -->
    <meta charset="UTF-8">

    <!-- ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© -->
    <title>Jomaro Restaurant and Cafe - Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø£ÙƒÙˆÙ„Ø§Øª ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</title>

    <!-- ÙˆØµÙ Ø§Ù„ØµÙØ­Ø© -->
    <meta name="description" content="Ù…Ø·Ø¹Ù… ÙˆÙƒØ§ÙÙŠÙ‡ Ø¬ÙˆÙ…Ø§Ø±Ùˆ - Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø£Ø·Ø¨Ø§Ù‚ Ù„Ø°ÙŠØ°Ø© ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª ÙØ§Ø®Ø±Ø© ÙÙŠ Ø£Ø¬ÙˆØ§Ø¡ Ø£Ù†ÙŠÙ‚Ø©. Ø§Ø­Ø¬Ø² Ø·Ø§ÙˆÙ„ØªÙƒ Ø§Ù„Ø¢Ù†!">

    <!-- Ù…ÙŠØªØ§ Ø§Ù„Ø±ÙˆØ¨ÙˆØªØ§Øª -->
    <meta name="robots" content="index, follow">

    <!-- Ø±Ø§Ø¨Ø· ÙƒØ§Ù†ÙˆÙ†ÙŠÙƒØ§Ù„ -->
    <link rel="canonical" href="https://example.com/this-page">

    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Favicon) -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">
    <link rel="icon" type="image/png" sizes="16x16" href="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">

    <!-- Open Graph Tags (Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒØŒ ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ø¥Ù„Ø®) -->
    <meta property="og:title" content="Jomaro Restaurant and Cafe">
    <meta property="og:description" content="Ù…Ø·Ø¹Ù… ÙˆÙƒØ§ÙÙŠÙ‡ Ø¬ÙˆÙ…Ø§Ø±Ùˆ - Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø£Ø·Ø¨Ø§Ù‚ Ù„Ø°ÙŠØ°Ø© ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª ÙØ§Ø®Ø±Ø© ÙÙŠ Ø£Ø¬ÙˆØ§Ø¡ Ø£Ù†ÙŠÙ‚Ø©.">
    <meta property="og:image" content="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">
    <meta property="og:url" content="https://example.com/this-page">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_AR">

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Jomaro Restaurant and Cafe">
    <meta name="twitter:description" content="Ù…Ø·Ø¹Ù… ÙˆÙƒØ§ÙÙŠÙ‡ Ø¬ÙˆÙ…Ø§Ø±Ùˆ - Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø£Ø·Ø¨Ø§Ù‚ Ù„Ø°ÙŠØ°Ø© ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª ÙØ§Ø®Ø±Ø© ÙÙŠ Ø£Ø¬ÙˆØ§Ø¡ Ø£Ù†ÙŠÙ‚Ø©.">
    <meta name="twitter:image" content="https://drive.google.com/uc?export=download&id=1sEuWkLCp-o1BWqcDyhol0q8NbbcbRKN9">
    <meta name="twitter:site" content="@your_twitter_handle"> <!-- Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø§Ø³Ù… Ø­Ø³Ø§Ø¨Ùƒ Ø¹Ù„Ù‰ ØªÙˆÙŠØªØ± -->

    <!-- Ù„ÙˆÙ† Ø§Ù„Ø«ÙŠÙ… Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© -->
    <meta name="theme-color" content="#d62828"> <!-- Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø·Ø§Ø¹Ù… -->

    <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù Ø£Ùˆ Ø§Ù„Ø´Ø±ÙƒØ© -->
    <meta name="author" content="Jomaro Restaurant and Cafe">

    <!-- ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ù„Ø§ ØªØ¤Ø«Ø± ÙÙŠ SEO Ù„ÙƒÙ† Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§) -->
    <meta name="keywords" content="Ù…Ø·Ø¹Ù…, ÙƒØ§ÙÙŠÙ‡, Ø¬ÙˆÙ…Ø§Ø±Ùˆ, Ø·Ø¹Ø§Ù…, Ù…Ø´Ø±ÙˆØ¨Ø§Øª, Ø­Ø¬Ø² Ø·Ø§ÙˆÙ„Ø©, Ù…Ø£ÙƒÙˆÙ„Ø§Øª, Ø´ÙŠØ´Ø©, Ù‚Ù‡ÙˆØ©, Ø­Ù„ÙˆÙŠØ§Øª">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¬ÙˆÙ…Ø§Ø±Ùˆ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="script/adman.css">
</head>
<body>
  <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginPage" class="login-container">
    <div class="login-box">
      <h2><i class="fas fa-lock"></i> Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
      <div class="form-group">
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="email" placeholder="admin@jomaro.com" />
      </div>
      <div class="form-group">
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="password" placeholder="********" />
      </div>
      <button class="btn" onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <div id="loginError" class="error"></div>
    </div>
  </div>
  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div id="dashboard" class="dashboard">
    <div class="header">
      <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¬ÙˆÙ…Ø§Ø±Ùˆ</h1>
      <!-- --- Ø§Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¶Ø§Ù --- -->
      <!-- --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ --- -->
      <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ -->
    <div class="debug-info" id="debugInfo">
      Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...
    </div>
    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <div class="tabs">
      <button class="logout-btn" style="background: #000000; border-color: #D4AF37;" onclick="window.open('admin-dashboard.html', '_blank')"> Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
      <button class="tab-btn" data-tab="categories">â• Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
      <button class="tab-btn active" data-tab="add-item">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
      <button class="tab-btn" data-tab="manage-items">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
      <button class="tab-btn" data-tab="orders">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      <button class="tab-btn" data-tab="promotions">ğŸ¯ Ø§Ù„Ø¹Ø±ÙˆØ¶</button>
      <button class="tab-btn" data-tab="fix-data">ğŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
    <!-- 1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <div id="categories" class="tab-content">
      <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆÙØ±Ø¹ÙŠØ©)</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
          <input type="text" id="mainCatName" placeholder="Ù…Ø«Ù„: Ù…Ø£ÙƒÙˆÙ„Ø§ØªØŒ Ù…Ø´Ø±ÙˆØ¨Ø§Øª" />
        </div>
        <div class="form-group">
          <button class="btn" onclick="addMainCategory()">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ</button>
        </div>
      </div>
      <hr style="border: 1px solid #444; margin: 20px 0;" />
      <h3>Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
          <select id="mainCatSelect"></select>
        </div>
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</label>
          <input type="text" id="subCatName" placeholder="Ù…Ø«Ù„: Ø¨ÙŠØªØ²Ø§ØŒ Ù‚Ù‡ÙˆØ©" />
        </div>
        <div class="form-group">
          <button class="btn" onclick="addSubCategory()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</button>
        </div>
      </div>
    </div>
    <!-- 2. Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯ -->
    <div id="add-item" class="tab-content active">
      <h2>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
          <select id="addItemMainCat" onchange="loadSubCategoriesForItem()"></select>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</label>
          <select id="addItemSubCat"></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" id="itemNameAr" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" id="itemNameEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„ÙˆØµÙ (Ø¹Ø±Ø¨ÙŠ)</label>
          <textarea id="itemDescAr"></textarea>
        </div>
        <div class="form-group">
          <label>Ø§Ù„ÙˆØµÙ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <textarea id="itemDescEn"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø³Ø¹Ø±</label>
          <input type="number" id="itemPrice" step="0.5" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø®ØµÙ… (%)</label>
          <input type="number" id="itemDiscount" value="0" min="0" max="100" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
          <input type="text" id="itemImageURL" placeholder="https://example.com/image.jpg Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ" />
        </div>
      </div>
      <!-- --- Ø²Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù --- -->
      <div class="form-row" style="margin-top: 30px; justify-content: center;">
        <div class="form-group" style="flex: 1; min-width: 300px;">
          <button class="btn" onclick="addItemOnly()" style="width: 100%;">
            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù
          </button>
        </div>
      </div>
    </div>
    <!-- 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù -->
    <div id="manage-items" class="tab-content">
      <h2>ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø­Ø°Ù Ø§Ù„Ø£ØµÙ†Ø§Ù</h2>
      <div class="filter-section">
        <h3 class="filter-title">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
        <div class="filter-buttons" id="mainCategoriesFilter">
          <button class="filter-btn active" data-category="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
        </div>
        <h3 class="filter-title">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©</h3>
        <div class="filter-buttons" id="subCategoriesFilter">
          <button class="filter-btn active" data-subcategory="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</button>
        </div>
        <!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªÙˆÙØ± -->
        <h3 class="filter-title">Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªÙˆÙØ±</h3>
        <div class="search-availability">
          <div class="form-group">
            <label>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù</label>
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." oninput="filterItems()">
          </div>
          <div class="form-group">
            <label>Ø§Ù„ØªÙˆÙØ±</label>
            <select id="availabilityFilter" onchange="filterItems()">
              <option value="">Ø§Ù„ÙƒÙ„</option>
              <option value="true">Ù…ØªÙˆÙØ± ÙÙ‚Ø·</option>
              <option value="false">ØºÙŠØ± Ù…ØªÙˆÙØ±</option>
            </select>
          </div>
        </div>
      </div>
      <div id="itemsContainer">
        <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù...</div>
      </div>
    </div>
    <!-- 4. Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© -->
    <div id="orders" class="tab-content">
      <h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h2>
      <div class="filter-section">
        <div class="filter-buttons" id="statusFilter">
          <button class="filter-btn active" data-status="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
          <button class="filter-btn" data-status="Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>
          <button class="filter-btn" data-status="Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…">Ø¬Ø§Ù‡Ø²</button>
          <button class="filter-btn" data-status="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
        </div>
      </div>
      <div id="ordersContainer">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ø·Ù„Ø¨</th>
              <th>Ø§Ù„ÙˆÙ‚Øª</th>
              <th>Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</th>
              <th>Ø§Ù„Ø£ØµÙ†Ø§Ù</th>
              <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="ordersTableBody">
            <tr><td colspan="7" style="text-align:center; padding: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- 5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠØ© -->
    <div id="promotions" class="tab-content">
      <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ ØªØ±ÙˆÙŠØ¬ÙŠ Ø¬Ø¯ÙŠØ¯</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" id="promoTitleAr" placeholder="Ø¹Ø±Ø¶ Ø®Ø§Øµ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" id="promoTitleEn" placeholder="Special Offer on this item" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ù†Øµ (Ø¹Ø±Ø¨ÙŠ)</label>
          <textarea id="promoTextAr" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ"></textarea>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù†Øµ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <textarea id="promoTextEn" placeholder="Offer details in English"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø´Ø¹Ø§Ø± (Badge) - Ø¹Ø±Ø¨ÙŠ</label>
          <input type="text" id="promoBadgeAr" placeholder="Ø®ØµÙ… 50%" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø´Ø¹Ø§Ø± (Badge) - Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</label>
          <input type="text" id="promoBadgeEn" placeholder="50% Off" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±Ø¶</label>
          <input type="text" id="promoImageURL" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±Ø¶ (Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ Ø£Ùˆ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±)" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„ØªØ±ØªÙŠØ¨</label>
          <input type="number" id="promoOrder" value="0" min="0" />
        </div>
      </div>
      <button class="btn" onclick="addPromotion()" style="width: 100%; margin: 20px 0;">
        <i class="fas fa-tag"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ÙˆÙŠØ¬ÙŠ
      </button>
      <hr style="border: 1px solid #444; margin: 30px 0;" />
      <h3 style="margin: 2rem 0 1rem;">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
      <!-- ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¥Ø¶Ø§ÙØ© class="items-grid" Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ø±Ù†Ù‹Ø§ -->
      <div id="promotionsList" class="items-grid"></div>
    </div>
    <!-- 6. Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <div id="fix-data" class="tab-content">
      <h2>Ø¥ØµÙ„Ø§Ø­ Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
      <p>ÙŠÙ‚ÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± Ø¨Ø¥ØµÙ„Ø§Ø­ Ø£ÙŠ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ù‡ÙŠÙƒÙ„ÙŠØ© ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£ØµÙ†Ø§Ù.</p>
      <button class="btn fix-data-btn" onclick="fixDataStructure()">
        <i class="fas fa-tools"></i> Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      </button>
      <div id="fixDataResult" class="debug-info"></div>
    </div>
  </div>
  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeEditModal()">&times;</span>
      <h2 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ†Ù</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
          <select id="editMainCat" onchange="loadEditSubCategories()"></select>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</label>
          <select id="editSubCat"></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" id="editNameAr" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" id="editNameEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„ÙˆØµÙ (Ø¹Ø±Ø¨ÙŠ)</label>
          <textarea id="editDescAr"></textarea>
        </div>
        <div class="form-group">
          <label>Ø§Ù„ÙˆØµÙ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <textarea id="editDescEn"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø³Ø¹Ø±</label>
          <input type="number" id="editPrice" step="0.5" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø®ØµÙ… (%)</label>
          <input type="number" id="editDiscount" min="0" max="100" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
          <input type="text" id="editImageURL" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
          <select id="editAvailable">
            <option value="true">Ù…ØªÙˆÙØ±</option>
            <option value="false">ØºÙŠØ± Ù…ØªÙˆÙØ±</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <button class="btn" onclick="updateItem()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        </div>
      </div>
      <input type="hidden" id="editItemKey">
      <input type="hidden" id="editOriginalMainCat">
      <input type="hidden" id="editOriginalSubCat">
    </div>
  </div>
  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ -->
  <div id="editPromoModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeEditPromoModal()">&times;</span>
      <h2 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" id="editPromoTitleAr" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" id="editPromoTitleEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ù†Øµ (Ø¹Ø±Ø¨ÙŠ)</label>
          <textarea id="editPromoTextAr"></textarea>
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù†Øµ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <textarea id="editPromoTextEn"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø§Ù„Ø´Ø¹Ø§Ø± (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" id="editPromoBadgeAr" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ø´Ø¹Ø§Ø± (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" id="editPromoBadgeEn" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
          <input type="text" id="editPromoImageURL" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±Ø¶ (Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ Ø£Ùˆ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±)" />
        </div>
        <div class="form-group">
          <label>Ø§Ù„ØªØ±ØªÙŠØ¨</label>
          <input type="number" id="editPromoOrder" min="0" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <button class="btn" onclick="updatePromotion()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶</button>
        </div>
      </div>
      <input type="hidden" id="editPromoKey">
    </div>
  </div>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script>
    // âœ… ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø£ÙˆÙ„Ù‹Ø§
    let allItemsData = {};
    let selectedMainCategory = '';
    let selectedSubCategory = '';
    let auth, db;
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDIs4dsxIk0xtuUaTGkIlVGKuFqwHBfr7g",
      authDomain: "app-da684.firebaseapp.com",
      databaseURL: "https://app-da684-default-rtdb.firebaseio.com",
      projectId: "app-da684",
      storageBucket: "app-da684.firebasestorage.app",
      messagingSenderId: "204039458597",
      appId: "1:204039458597:web:5be11d7494ac10cb3314cc"
    };
    try {
      firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      db = firebase.database();
      console.log("Firebase initialized successfully");
      updateDebugInfo("Firebase Ù…Ù‡ÙŠØ£ Ø¨Ù†Ø¬Ø§Ø­", "success");
    } catch (error) {
      console.error("Firebase initialization error:", error);
      updateDebugInfo("Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase: " + error.message, "error");
    }
    function updateDebugInfo(message, type = "info") {
      const debugInfo = document.getElementById("debugInfo");
      if (debugInfo) {
        debugInfo.innerHTML = `Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: ${message}`;
        debugInfo.style.color = type === "error" ? "red" : type === "success" ? "green" : "white";
      }
    }
    // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø±ÙˆØ§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ Ø¥Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©
    function convertGoogleDriveURL(url) {
      if (!url) return '';
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø© (Ù…Ø«Ù„ Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„Ø°ÙŠ Ø°ÙƒØ±ØªÙ‡)
      if (url.includes('lh3.googleusercontent.com')) {
        return url; // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ø§Ù„ÙØ¹Ù„
      }
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ù†ÙˆØ¹ Ù…Ø´Ø§Ø±ÙƒØ© Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ
      if (url.includes('drive.google.com')) {
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        const match = url.match(/\/d\/([^\/]+)/);
        if (match && match[1]) {
          return `https://lh3.googleusercontent.com/d/${match[1]}=s0`;
        }
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ Ø±ÙˆØ§Ø¨Ø· Ø£Ø®Ø±Ù‰
        const altMatch = url.match(/id=([^&]+)/);
        if (altMatch && altMatch[1]) {
          return `https://lh3.googleusercontent.com/d/${altMatch[1]}=s0`;
        }
      }
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙØŒ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· ÙƒÙ…Ø§ Ù‡Ùˆ
      return url;
    }
    // Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.getAttribute('data-tab');
        document.getElementById(tab).classList.add('active');
        if (tab === 'categories') loadMainCategoriesForSub();
        if (tab === 'manage-items') loadAllItems();
        if (tab === 'orders') loadOrders();
        if (tab === 'promotions') loadPromotions();
      });
    });
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const error = document.getElementById("loginError");
      error.textContent = "";
      if (!email || !password) {
        error.textContent = "Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
        return;
      }
      updateDebugInfo("Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...");
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          loginPage.style.display = "none";
          dashboard.style.display = "block";
          loadMainCategoriesForSub();
          loadMainCategoriesForItem();
          loadAllItems();
          checkDatabaseConnection();
        })
        .catch(err => {
          error.textContent = "Ø®Ø·Ø£: " + err.message;
          updateDebugInfo("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + err.message, "error");
        });
    }
    function logout() {
      auth.signOut().then(() => {
        dashboard.style.display = "none";
        loginPage.style.display = "flex";
        updateDebugInfo("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
      });
    }
    function checkDatabaseConnection() {
      if (!db) return;
      db.ref('.info/connected').on('value', (snapshot) => {
        updateDebugInfo(snapshot.val() ? "Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" : "ØºÙŠØ± Ù…ØªØµÙ„", snapshot.val() ? "success" : "error");
      });
    }
    // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø±ÙˆØ§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ Ù„Ù„Ø¹Ø±Ø¶
    function getDirectImageURL(url) {
      if (!url) return 'https://via.placeholder.com/300x200/222/D4AF37?text=No+Image';
      try {
        if (url.includes('drive.google.com')) {
          const idMatch = url.match(/\/d\/([^\/]+)/);
          if (idMatch && idMatch[1]) {
            return `https://drive.google.com/uc?export=view&id=${idMatch[1]}`;
          }
        }
        return url;
      } catch (e) {
        return 'https://via.placeholder.com/300x200/222/D4AF37?text=Error';
      }
    }
    // Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ
    function addMainCategory() {
      const name = document.getElementById("mainCatName").value.trim();
      if (!name) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…");
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      db.ref('menuItems/' + name).set({ type: "mainCategory" })
        .then(() => {
          alert("ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©: " + name);
          document.getElementById("mainCatName").value = "";
          loadMainCategoriesForSub();
          loadMainCategoriesForItem();
        })
        .catch(err => alert("Ø®Ø·Ø£: " + err.message));
    }
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    function loadMainCategoriesForSub() {
      const select = document.getElementById("mainCatSelect");
      select.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ</option>";
      // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
      db.ref('menuItems').once('value').then(snapshot => {
        snapshot.forEach(snap => {
          if (snap.key !== 'type') {
            const opt = document.createElement("option");
            opt.value = snap.key;
            opt.textContent = snap.key;
            select.appendChild(opt);
          }
        });
      }).catch(err => {
        console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:", err);
        alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: " + err.message);
      });
    }
    // Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ
    function addSubCategory() {
      const main = document.getElementById("mainCatSelect").value;
      const sub = document.getElementById("subCatName").value.trim();
      if (!main || !sub) return alert("Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ");
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      db.ref('menuItems/' + main + '/' + sub).set({ type: "subCategory" })
        .then(() => {
          alert("ØªÙ… Ø¥Ø¶Ø§ÙØ©: " + sub);
          document.getElementById("subCatName").value = "";
          loadMainCategoriesForItem();
        })
        .catch(err => alert("Ø®Ø·Ø£: " + err.message));
    }
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù
    function loadMainCategoriesForItem() {
      const select = document.getElementById("addItemMainCat");
      select.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ</option>";
      // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
      db.ref('menuItems').once('value').then(snapshot => {
        snapshot.forEach(snap => {
          if (snap.key !== 'type') {
            const opt = document.createElement("option");
            opt.value = snap.key;
            opt.textContent = snap.key;
            select.appendChild(opt);
          }
        });
        loadSubCategoriesForItem();
      }).catch(err => {
        console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù„Ù„Ø¥Ø¶Ø§ÙØ©:", err);
      });
    }
    function loadSubCategoriesForItem() {
      const main = document.getElementById("addItemMainCat").value;
      const select = document.getElementById("addItemSubCat");
      select.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ</option>";
      if (!main) return;
      // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
      db.ref('menuItems/' + main).once('value').then(snapshot => {
        snapshot.forEach(subSnap => {
          if (subSnap.key !== 'type') {
            const opt = document.createElement("option");
            opt.value = subSnap.key;
            opt.textContent = subSnap.key;
            select.appendChild(opt);
          }
        });
      }).catch(err => {
        console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©:", err);
      });
    }
    // --- Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ÙÙ‚Ø· --- //
    function addItemOnly() {
      const mainCat = document.getElementById("addItemMainCat").value;
      const subCat = document.getElementById("addItemSubCat").value;
      const nameAr = document.getElementById("itemNameAr").value.trim();
      const nameEn = document.getElementById("itemNameEn").value.trim();
      const descAr = document.getElementById("itemDescAr").value;
      const descEn = document.getElementById("itemDescEn").value;
      const price = parseFloat(document.getElementById("itemPrice").value);
      const discount = parseInt(document.getElementById("itemDiscount").value) || 0;
      let imageURL = document.getElementById("itemImageURL").value.trim();
      if (!mainCat || !subCat || !nameAr || !nameEn || isNaN(price)) {
        return alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
      }
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      imageURL = convertGoogleDriveURL(imageURL);
      const newItem = {
        nameAr, nameEn,
        descriptionAr: descAr,
        descriptionEn: descEn,
        price,
        discount,
        imageURL,
        available: true,
        categoryAr: subCat,
        categoryEn: getEnglishCategory(subCat),
        createdAt: firebase.database.ServerValue.TIMESTAMP
      };
      const newItemKey = firebase.database().ref().child('menuItems').push().key;
      const updates = {};
      updates[`menuItems/${mainCat}/${subCat}/${newItemKey}`] = newItem;
      db.ref().update(updates)
        .then(() => {
          alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­");
          // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
          document.getElementById("itemNameAr").value = "";
          document.getElementById("itemNameEn").value = "";
          document.getElementById("itemDescAr").value = "";
          document.getElementById("itemDescEn").value = "";
          document.getElementById("itemPrice").value = "";
          document.getElementById("itemDiscount").value = "0";
          document.getElementById("itemImageURL").value = "";
        })
        .catch(err => {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù:", err);
          alert("Ø®Ø·Ø£: " + err.message);
        });
    }
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
    function loadAllItems() {
      const container = document.getElementById("itemsContainer");
      container.innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
      db.ref('menuItems').once('value')
        .then(snapshot => {
          const data = snapshot.val();
          if (!data) {
            container.innerHTML = '<p class="no-items">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ø¨Ø¹Ø¯.</p>';
            allItemsData = {};
            renderFilterButtons();
            return;
          }
          allItemsData = data;
          renderFilterButtons();
          filterItems();
        })
        .catch(err => {
          console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù:", err);
          container.innerHTML = `<div class="error">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${err.message}</div>`;
        });
    }
    function renderFilterButtons() {
      const mainFilter = document.getElementById('mainCategoriesFilter');
      const subFilter = document.getElementById('subCategoriesFilter');
      mainFilter.innerHTML = '<button class="filter-btn active" data-category="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>';
      subFilter.innerHTML = '<button class="filter-btn active" data-subcategory="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</button>';
      Object.keys(allItemsData).forEach(cat => {
        if (cat !== 'type') {
          const btn = document.createElement('button');
          btn.className = 'filter-btn';
          btn.setAttribute('data-category', cat);
          btn.textContent = cat;
          btn.onclick = () => filterByMainCategory(cat);
          mainFilter.appendChild(btn);
        }
      });
    }
    function filterByMainCategory(mainCat) {
      selectedMainCategory = mainCat;
      selectedSubCategory = '';
      document.querySelectorAll('#mainCategoriesFilter .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-category') === mainCat);
      });
      const subFilter = document.getElementById('subCategoriesFilter');
      subFilter.innerHTML = '<button class="filter-btn active" data-subcategory="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</button>';
      const mainCatData = allItemsData[mainCat] || {};
      Object.keys(mainCatData).forEach(sub => {
        if (sub !== 'type') {
          const btn = document.createElement('button');
          btn.className = 'filter-btn';
          btn.setAttribute('data-subcategory', sub);
          btn.textContent = sub;
          btn.onclick = () => filterBySubCategory(sub);
          subFilter.appendChild(btn);
        }
      });
      filterItems();
    }
    function filterBySubCategory(subCat) {
      selectedSubCategory = subCat;
      document.querySelectorAll('#subCategoriesFilter .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-subcategory') === subCat);
      });
      filterItems();
    }
    function filterItems() {
      const container = document.getElementById("itemsContainer");
      const searchTerm = document.getElementById("searchInput")?.value.trim().toLowerCase() || '';
      const availabilityFilter = document.getElementById("availabilityFilter")?.value; // "" | "true" | "false"
      container.innerHTML = '';
      let hasItems = false;
      Object.keys(allItemsData).forEach(mainCat => {
        if (mainCat === 'type') return;
        if (!selectedMainCategory || mainCat === selectedMainCategory) {
          const mainCatData = allItemsData[mainCat];
          let mainHasItems = false;
          const mainDiv = document.createElement('div');
          Object.keys(mainCatData).forEach(subCat => {
            if (subCat === 'type') return;
            if (!selectedSubCategory || subCat === selectedSubCategory) {
              const items = mainCatData[subCat];
              if (!items || typeof items !== 'object') return;
              let subHasItems = false;
              const subHeader = document.createElement('h3');
              subHeader.className = 'category-header';
              subHeader.textContent = `${subCat} (ØªØ­Øª: ${mainCat})`;
              const grid = document.createElement('div');
              grid.className = 'items-grid';
              Object.keys(items).forEach(key => {
                if (key === 'type') return;
                const item = items[key];
                if (typeof item !== 'object' || !item.nameAr) return;
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø­Ø«
                const matchesSearch = 
                  !searchTerm || 
                  item.nameAr.toLowerCase().includes(searchTerm) || 
                  item.nameEn.toLowerCase().includes(searchTerm);
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙØ±
                const matchesAvailability = 
                  availabilityFilter === "" || 
                  item.available?.toString() === availabilityFilter;
                if (matchesSearch && matchesAvailability) {
                  const card = createItemCard(mainCat, subCat, key, item);
                  grid.appendChild(card);
                  hasItems = true;
                  mainHasItems = true;
                  subHasItems = true;
                }
              });
              if (subHasItems) {
                mainDiv.appendChild(subHeader);
                mainDiv.appendChild(grid);
              }
            }
          });
          if (mainHasItems) container.appendChild(mainDiv);
        }
      });
      if (!hasItems) {
        container.innerHTML = "<p class='no-items'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ±Ø©.</p>";
      }
    }
    function createItemCard(mainCat, subCat, key, item) {
      const card = document.createElement('div');
      card.className = 'item-card';
      const img = getDirectImageURL(item.imageURL);
      card.innerHTML = `
        <img src="${img}" alt="${item.nameAr}" class="item-image" onerror="this.src='https://via.placeholder.com/300x200/222/D4AF37?text=No+Image'">
        <div class="item-details">
          <div class="item-name">${item.nameAr}</div>
          <div class="item-description">${item.descriptionAr || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</div>
          <div class="item-price">Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬.Ù…</div>
          ${item.discount > 0 ? `<div class="item-discount">Ø§Ù„Ø®ØµÙ…: ${item.discount}%</div>` : ''}
          <div class="item-actions">
            <button class="action-btn edit-btn" onclick="openEditModal('${mainCat}', '${subCat}', '${key}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
              <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button class="action-btn delete-btn" onclick="deleteItem('${mainCat}', '${subCat}', '${key}')">
              <i class="fas fa-trash"></i> Ø­Ø°Ù
            </button>
          </div>
        </div>
      `;
      return card;
    }
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    function loadOrders() {
      const tbody = document.getElementById("ordersTableBody");
      tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</td></tr>';
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ù„Ù„Ø®ØµÙˆØµÙŠØ©)
      if (!auth.currentUser) {
        tbody.innerHTML = '<tr><td colspan="7" style="color:red; text-align:center;">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª.</td></tr>';
        return;
      }
      db.ref('orders').orderByChild('timestamp').once('value')
        .then(snapshot => {
          const orders = snapshot.val();
          tbody.innerHTML = '';
          if (!orders || Object.keys(orders).length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª.</td></tr>';
            return;
          }
          Object.entries(orders).reverse().forEach(([orderId, order]) => {
            const date = order.timestamp ? new Date(order.timestamp).toLocaleString('ar') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const itemsHTML = (order.items || []).map(item => `${item.nameAr} Ã— ${item.quantity}`).join('<br>');
            const tr = document.createElement('tr');
            tr.setAttribute('data-order-id', orderId);
            tr.setAttribute('data-status', order.status || '');
            tr.innerHTML = `
              <td>${orderId.replace('JMR-', '')}</td>
              <td>${date}</td>
              <td style="font-weight: bold; color: var(--primary);">${order.tableNumber || '?'}</td>
              <td style="font-size: 0.9rem;">${itemsHTML}</td>
              <td>${(order.total || 0).toFixed(2)} Ø¬.Ù…</td>
              <td>
                <select class="order-status-select" onchange="updateOrderStatus('${orderId}', this.value)">
                  <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</option>
                  <option value="Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…" ${order.status === 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…' ? 'selected' : ''}>Ø¬Ø§Ù‡Ø²</option>
                  <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" ${order.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…' ? 'selected' : ''}>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                </select>
              </td>
              <td>
                <button class="btn" style="background:var(--success)" onclick="completeOrder('${orderId}')">ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
          filterOrdersByStatus();
        })
        .catch(err => {
          tbody.innerHTML = `<tr><td colspan="7" style="color:red; text-align:center;">Ø®Ø·Ø£: ${err.message}</td></tr>`;
        });
    }
    function updateOrderStatus(orderId, newStatus) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      db.ref('orders/' + orderId).update({ status: newStatus })
        .then(() => {
          if (newStatus === "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…") {
            const row = document.querySelector(`tr[data-order-id="${orderId}"]`);
            if (row) {
              row.style.transition = "opacity 0.5s";
              row.style.opacity = "0";
              setTimeout(() => row.remove(), 500);
            }
          }
          showNotification("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
        })
        .catch(err => alert("Ø®Ø·Ø£: " + err.message));
    }
    function completeOrder(orderId) {
      if (!confirm("Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙ„Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) return;
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      db.ref('orders/' + orderId).update({ status: "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" })
        .then(() => {
          const row = document.querySelector(`tr[data-order-id="${orderId}"]`);
          if (row) {
            row.style.transition = "opacity 0.5s";
            row.style.opacity = "0";
            setTimeout(() => row.remove(), 500);
          }
          showNotification("ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…");
        })
        .catch(err => alert("Ø®Ø·Ø£: " + err.message));
    }
    function filterOrdersByStatus() {
      const selectedStatus = document.querySelector('#statusFilter .filter-btn.active')?.getAttribute('data-status') || '';
      document.querySelectorAll('#ordersTableBody tr').forEach(tr => {
        const status = tr.getAttribute('data-status');
        tr.style.display = !selectedStatus || selectedStatus === status ? '' : 'none';
      });
    }
    // Ø¥Ø¹Ø¯Ø§Ø¯ ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    document.querySelectorAll('#statusFilter .filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#statusFilter .filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        filterOrdersByStatus();
      });
    });
    function showNotification(message) {
      const n = document.createElement('div');
      n.textContent = message;
      n.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#D4AF37;color:#000;padding:1rem 2rem;border-radius:30px;z-index:1000;animation:fadeInOut 3s forwards;';
      document.body.appendChild(n);
      setTimeout(() => n.remove(), 3000);
    }
    function openEditModal(mainCat, subCat, key, item) {
      document.getElementById('editOriginalMainCat').value = mainCat;
      document.getElementById('editOriginalSubCat').value = subCat;
      document.getElementById('editItemKey').value = key;
      document.getElementById('editNameAr').value = item.nameAr || '';
      document.getElementById('editNameEn').value = item.nameEn || '';
      document.getElementById('editDescAr').value = item.descriptionAr || '';
      document.getElementById('editDescEn').value = item.descriptionEn || '';
      document.getElementById('editPrice').value = item.price || '';
      document.getElementById('editDiscount').value = item.discount || 0;
      document.getElementById('editImageURL').value = item.imageURL || '';
      document.getElementById('editAvailable').value = item.available ? 'true' : 'false';
      const mainSelect = document.getElementById('editMainCat');
      mainSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ</option>';
      // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
      db.ref('menuItems').once('value').then(snapshot => {
        snapshot.forEach(snap => {
          if (snap.key !== 'type') {
            const opt = document.createElement('option');
            opt.value = snap.key;
            opt.textContent = snap.key;
            opt.selected = (snap.key === mainCat);
            mainSelect.appendChild(opt);
          }
        });
        loadEditSubCategories(subCat);
      });
      document.getElementById('editModal').style.display = 'block';
    }
    function loadEditSubCategories(subCatToSelect) {
      const mainCat = document.getElementById('editMainCat').value;
      const subSelect = document.getElementById('editSubCat');
      subSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ</option>';
      if (!mainCat) return;
      // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
      db.ref('menuItems/' + mainCat).once('value').then(snapshot => {
        snapshot.forEach(subSnap => {
          if (subSnap.key !== 'type') {
            const opt = document.createElement('option');
            opt.value = subSnap.key;
            opt.textContent = subSnap.key;
            if (subCatToSelect && subSnap.key === subCatToSelect) opt.selected = true;
            subSelect.appendChild(opt);
          }
        });
      });
    }
    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ†Ù Ù…Ø¹ ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
    function updateItem() {
      const origMain = document.getElementById('editOriginalMainCat').value;
      const origSub = document.getElementById('editOriginalSubCat').value;
      const key = document.getElementById('editItemKey').value;
      const mainCat = document.getElementById('editMainCat').value;
      const subCat = document.getElementById('editSubCat').value;
      const nameAr = document.getElementById('editNameAr').value.trim();
      const nameEn = document.getElementById('editNameEn').value.trim();
      const price = parseFloat(document.getElementById('editPrice').value);
      let imageURL = document.getElementById('editImageURL').value.trim();
      if (!mainCat || !subCat || !nameAr || !nameEn || isNaN(price)) return alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      // ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ
      imageURL = convertGoogleDriveURL(imageURL);
      const updated = {
        nameAr, nameEn,
        descriptionAr: document.getElementById('editDescAr').value,
        descriptionEn: document.getElementById('editDescEn').value,
        price, 
        discount: parseInt(document.getElementById('editDiscount').value) || 0,
        imageURL: imageURL,
        available: document.getElementById('editAvailable').value === 'true',
        categoryAr: subCat,
        categoryEn: getEnglishCategory(subCat)
      };
      if (origMain !== mainCat || origSub !== subCat) {
        db.ref('menuItems/' + origMain + '/' + origSub + '/' + key).remove()
          .then(() => db.ref('menuItems/' + mainCat + '/' + subCat + '/' + key).set(updated))
          .then(() => { 
            alert("ØªÙ… Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«"); 
            closeEditModal(); 
            loadAllItems(); 
          })
          .catch(err => alert("Ø®Ø·Ø£: " + err.message));
      } else {
        db.ref('menuItems/' + mainCat + '/' + subCat + '/' + key).update(updated)
          .then(() => { 
            alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«"); 
            closeEditModal(); 
            loadAllItems(); 
          })
          .catch(err => alert("Ø®Ø·Ø£: " + err.message));
      }
    }
    function deleteItem(mainCat, subCat, key) {
      if (confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ")) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù
        if (!auth.currentUser) {
          alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
          return;
        }
        db.ref('menuItems/' + mainCat + '/' + subCat + '/' + key).remove()
          .then(() => { 
            alert("ØªÙ… Ø§Ù„Ø­Ø°Ù"); 
            loadAllItems(); 
          })
          .catch(err => alert("Ø®Ø·Ø£: " + err.message));
      }
    }
    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ ---
    function addPromotion() {
      const titleAr = document.getElementById("promoTitleAr").value.trim();
      const titleEn = document.getElementById("promoTitleEn").value.trim();
      const textAr = document.getElementById("promoTextAr").value.trim();
      const textEn = document.getElementById("promoTextEn").value.trim();
      const badgeAr = document.getElementById("promoBadgeAr").value.trim();
      const badgeEn = document.getElementById("promoBadgeEn").value.trim();
      let image = document.getElementById("promoImageURL").value.trim();
      const order = parseInt(document.getElementById("promoOrder").value) || 0;
      if (!titleAr || !titleEn || !textAr || !textEn || !image) {
        alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
        return;
      }
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      // ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ
      image = convertGoogleDriveURL(image);
      const promo = {
        titleAr, titleEn,
        textAr, textEn,
        badgeAr, badgeEn,
        image,
        order,
        createdAt: firebase.database.ServerValue.TIMESTAMP
      };
      const newKey = db.ref().push().key;
      db.ref('promotions/' + newKey).set(promo)
        .then(() => {
          alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø±Ø¶");
          document.getElementById("promoTitleAr").value = "";
          document.getElementById("promoTitleEn").value = "";
          document.getElementById("promoTextAr").value = "";
          document.getElementById("promoTextEn").value = "";
          document.getElementById("promoBadgeAr").value = "";
          document.getElementById("promoBadgeEn").value = "";
          document.getElementById("promoImageURL").value = "";
          document.getElementById("promoOrder").value = "0";
          loadPromotions();
        })
        .catch(err => alert("Ø®Ø·Ø£: " + err.message));
    }
    function loadPromotions() {
      const container = document.getElementById("promotionsList");
      container.innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      // ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
      db.ref('promotions').orderByChild('order').once('value').then(snapshot => {
        const data = snapshot.val();
        if (!data) {
          container.innerHTML = '<div class="debug-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶</div>';
          return;
        }
        container.innerHTML = '';
        Object.keys(data).forEach(key => {
          const promo = data[key];
          const div = document.createElement('div');
          div.className = 'item-card';
          div.innerHTML = `
            <img src="${getDirectImageURL(promo.image)}" alt="${promo.titleAr}" class="item-image" onerror="this.src='https://via.placeholder.com/300x200/222/D4AF37?text=No+Image'">
            <div class="item-details">
              <div class="item-name">${promo.titleAr}</div>
              <div class="item-description">${promo.textAr}</div>
              ${promo.badgeAr ? `<div class="promo-badge">${promo.badgeAr}</div>` : ''}
              <div class="item-price">Ø§Ù„ØªØ±ØªÙŠØ¨: ${promo.order}</div>
            </div>
            <div class="item-actions">
              <button class="action-btn edit-btn" onclick="openEditPromoModal('${key}', ${JSON.stringify(promo).replace(/"/g, '&quot;')})">
                <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
              </button>
              <button class="action-btn delete-btn" onclick="deletePromotion('${key}')">
                <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
            </div>
          `;
          container.appendChild(div);
        });
      }).catch(error => {
        console.error("Error loading promotions:", error);
        container.innerHTML = `<div class="error">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶: ${error.message}</div>`;
      });
    }
    function openEditPromoModal(key, promo) {
      document.getElementById("editPromoKey").value = key;
      document.getElementById("editPromoTitleAr").value = promo.titleAr || '';
      document.getElementById("editPromoTitleEn").value = promo.titleEn || '';
      document.getElementById("editPromoTextAr").value = promo.textAr || '';
      document.getElementById("editPromoTextEn").value = promo.textEn || '';
      document.getElementById("editPromoBadgeAr").value = promo.badgeAr || '';
      document.getElementById("editPromoBadgeEn").value = promo.badgeEn || '';
      document.getElementById("editPromoImageURL").value = promo.image || '';
      document.getElementById("editPromoOrder").value = promo.order || 0;
      document.getElementById("editPromoModal").style.display = 'block';
    }
    function closeEditPromoModal() {
      document.getElementById("editPromoModal").style.display = 'none';
    }
    function updatePromotion() {
      const key = document.getElementById("editPromoKey").value;
      const titleAr = document.getElementById("editPromoTitleAr").value.trim();
      const titleEn = document.getElementById("editPromoTitleEn").value.trim();
      const textAr = document.getElementById("editPromoTextAr").value.trim();
      const textEn = document.getElementById("editPromoTextEn").value.trim();
      const badgeAr = document.getElementById("editPromoBadgeAr").value.trim();
      const badgeEn = document.getElementById("editPromoBadgeEn").value.trim();
      let image = document.getElementById("editPromoImageURL").value.trim();
      const order = parseInt(document.getElementById("editPromoOrder").value) || 0;
      if (!titleAr || !titleEn || !textAr || !textEn || !image) {
        alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
        return;
      }
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      // ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±ÙŠÙ
      image = convertGoogleDriveURL(image);
      const updates = {
        titleAr, titleEn,
        textAr, textEn,
        badgeAr, badgeEn,
        image,
        order
      };
      db.ref('promotions/' + key).update(updates)
        .then(() => {
          alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶");
          closeEditPromoModal();
          loadPromotions();
        })
        .catch(err => alert("Ø®Ø·Ø£: " + err.message));
    }
    function deletePromotion(key) {
      if (confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ØŸ")) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù
        if (!auth.currentUser) {
          alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
          return;
        }
        db.ref('promotions/' + key).remove()
          .then(() => {
            alert("ØªÙ… Ø§Ù„Ø­Ø°Ù");
            loadPromotions();
          })
          .catch(err => alert("Ø®Ø·Ø£: " + err.message));
      }
    }
    function fixDataStructure() {
      const result = document.getElementById('fixDataResult');
      result.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­...";
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ (Ø¹Ù…Ù„ÙŠØ© ÙƒØªØ§Ø¨Ø©)
      if (!auth.currentUser) {
        alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      db.ref('menuItems').once('value').then(snapshot => {
        const data = snapshot.val() || {};
        let fixed = 0;
        Object.keys(data).forEach(main => {
          if (main !== 'type') {
            Object.keys(data[main]).forEach(sub => {
              if (sub !== 'type' && data[main][sub] && data[main][sub].nameAr !== undefined) {
                const itemKey = db.ref().push().key;
                const updates = {};
                updates[`menuItems/${main}/${sub}/${itemKey}`] = data[main][sub];
                updates[`menuItems/${main}/${sub}/type`] = "subCategory";
                Object.keys(data[main][sub]).forEach(k => {
                  if (k !== 'type' && k !== 'createdAt') updates[`menuItems/${main}/${sub}/${k}`] = null;
                });
                db.ref().update(updates).then(() => fixed++);
              }
            });
          }
        });
        setTimeout(() => {
          result.innerHTML = `ØªÙ… Ø¥ØµÙ„Ø§Ø­ ${fixed} Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ±.`;
        }, 1000);
      });
    }
    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
    function getEnglishCategory(arabicCategory) {
      const categoryMap = {
        'Ù…Ø£ÙƒÙˆÙ„Ø§Øª': 'Food',
        'Ù…Ø´Ø±ÙˆØ¨Ø§Øª': 'Drinks',
        'Ø­Ù„ÙˆÙŠØ§Øª': 'Desserts',
        'Ù…Ù‚Ø¨Ù„Ø§Øª': 'Appetizers',
        'Ø³Ù„Ø·Ø§Øª': 'Salads',
        'Ø¨ÙŠØªØ²Ø§': 'Pizza',
        'Ø¨Ø±Ø¬Ø±': 'Burger',
        'Ù…Ø¹Ø¬Ù†Ø§Øª': 'Pastries',
        'Ù‚Ù‡ÙˆØ©': 'Coffee',
        'Ø¹ØµØ§Ø¦Ø±': 'Juices',
        'Ø´Ø§ÙŠ': 'Tea'
      };
      return categoryMap[arabicCategory] || arabicCategory;
    }
    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    auth.onAuthStateChanged(user => {
      if (user) {
        loginPage.style.display = "none";
        dashboard.style.display = "block";
        loadMainCategoriesForSub();
        loadMainCategoriesForItem();
        loadAllItems();
        checkDatabaseConnection();
      } else {
        dashboard.style.display = "none";
        loginPage.style.display = "flex";
        updateDebugInfo("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
      }
    });
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    window.onclick = e => {
      if (e.target === document.getElementById('editModal')) closeEditModal();
      if (e.target === document.getElementById('editPromoModal')) closeEditPromoModal();
    };
  </script>
</body>
</html>